# 08 系列审计：命名排序、合并与瘦身建议

本文档为 08 系列（合规与门禁）的**审计结论**：当前结构、命名与顺序问题、可合并项、可瘦身项及建议执行顺序。**受众**：产品、法务、风控、架构；**用法**：按建议落地时可先改索引与链接，再执行重命名/合并/瘦身。文档版本与最后更新见 [00-文档索引](00-文档索引.md)。

---

## 一、当前 08 系列清单与行数

| 序号 | 当前文件名 | 约行数 | 角色 | 备注 |
|------|------------|--------|------|------|
| — | **08-1-战略与合规风险检查清单.md** | **949** | 主文档 | 检查项、Gate、上线就炸 11+12～22、A～Q 全节、附录 Gate；**体量最大** |
| — | **08-2-附录-闭合工单表.md** | 198 | 附录 | 工单 workitem、Gate 汇总、定稿前检查、W-PDP-SSOT、W-GATE-CROSS-CHECK |
| — | ~~08-2-语义一致性审查表.md~~ | — | 已并入 08-2 | 已并入 08-2 [发版前审查一](08-2-附录-闭合工单表.md#发版前审查一关键语义一致性审查表) |
| — | ~~08-2-Gate冲突矩阵与优先级.md~~ | — | 已并入 08-2 | 已并入 08-2 [发版前审查二](08-2-附录-闭合工单表.md#发版前审查二gate-冲突矩阵与优先级规则) |
| — | **08-3-参数与门禁表.md** | 139 | 定稿载体 | SSOT、26 key、权限层级、映射表、变更记录 |
| — | **08-4-对外口径包.md** | 188 | 定稿载体 | PDP、固定 8 章、协议终极边界与终局设计 |
| — | **08-5-CI与一致性落地说明.md**（原 08-CI） | 80 | CI 落地 | PR 模板、校验脚本、CI/部署/运行时校验说明；**已统一为 08-5 数字序号** |
| — | **ops/RUNBOOK.md** | 210 | 定稿载体 | §1～§11、定稿表、P0 必填项 |

**合计**：docs 下 6 个 08 相关文件（08-0～08-5）+ ops/RUNBOOK；主文档 08-1 约占总行数一半以上。**企业级审计结论**见本 08-0 §十一、§十二、§十三（无独立「08-企业级审核报告」文档）。

---

## 二、命名与排序问题

- **08-2 多文件同前缀**：三个文件都叫「08-2-xxx」，不利于排序与口头区分（「08-2」指哪一份不清晰）。
- **08-CI 非数字序号**（已解决）：原 08-CI 与 08-1～08-4 混排时顺序不直观；已重命名为 **08-5-CI与一致性落地说明.md**，统一数字序号。
- **无统一阅读顺序编号**：索引中 08 系列按「主文档→附录→定稿载体→CI」叙述，但文件名未体现顺序。

**建议命名与排序**（按阅读/使用顺序）：**本轮已执行**：08-CI → 08-5 重命名已完成，见下文「本轮已执行：08 重排与全库技术检查」。

| 建议序号 | 建议文件名 | 对应当前文件 | 说明 |
|----------|------------|--------------|------|
| 08-1 | **08-1-战略与合规风险检查清单.md** | 08-1（不变） | 主文档，保持 |
| 08-2 | **08-2-附录-闭合工单表.md** 或 08-2-闭合工单与发版前审查 | 08-2-附录-闭合工单表（语义+Gate 已并入） | 保持当前文件名或合并后改名 |
| 08-3 | **08-3-参数与门禁表.md** | 08-3（不变） | 定稿载体 SSOT |
| 08-4 | **08-4-对外口径包.md** | 08-4（不变） | 定稿载体 PDP |
| 08-5 | **08-5-CI与一致性落地说明.md** | **已落地**（原 08-CI） | 统一为 08-5，便于排序 |
| — | **ops/RUNBOOK.md** | 不变 | 保持路径，索引中明确为 08 定稿载体之一 |

若**不合并**仅重命名，则建议：

- `08-2-附录-闭合工单表.md` → 保持或改为 **08-2-闭合工单表.md**（去掉「附录」二字，与 08-1 主文档对称）。
- `08-2-语义一致性审查表.md` → **08-2a-语义一致性审查表.md** 或 **08-附录-语义与Gate审查.md**（与 08-2 区分）。
- `08-2-Gate冲突矩阵与优先级.md` → **08-2b-Gate冲突矩阵与优先级.md** 或 并入 08-2/08-2a。
- `08-CI-落地说明.md` → **08-5-CI与一致性落地说明.md**。

---

## 三、可合并项

| 合并方案 | 操作 | 理由 |
|----------|------|------|
| **A. 语义 + Gate 并入 08-2** | 将「08-2-语义一致性审查表」与「08-2-Gate冲突矩阵与优先级」的**正文**并入 **08-2-附录-闭合工单表** 末尾，作为两节：「发版前审查一：语义一致性」「发版前审查二：Gate 冲突矩阵与优先级」。然后删除原两个小文件，全库链接改为「08-2-闭合工单表#发版前审查一」等。 | 两文件均属发版前勾选用，且 08-2 已引用它们；合并后发版前只需打开 08-2 即可完成工单+语义+冲突三项，减少文件数。 |
| **B. 语义 + Gate 合并为单文件** | 新建 **08-2-发版前审查表.md**，内容＝语义一致性审查表 + Gate 冲突矩阵与优先级；原两文件删除。08-2 工单表仅保留「见 08-2-发版前审查表」链接。 | 不加重 08-2 体量，但 08-2 前缀下仍有两个文件（工单表 + 发版前审查表），命名需区分。 |
| **C. 不合并** | 仅做重命名（08-2a / 08-2b），便于排序与查找。 | 改动最小，保留「一文件一用途」。 |

**推荐**：**方案 A**（语义 + Gate 并入 08-2）。合并后 08 系列 docs 下由 7 个减为 **5 个**（08-1、08-2、08-3、08-4、08-5），且发版前检查入口单一。

---

## 四、可瘦身项

| 文档 | 当前问题 | 瘦身建议 |
|------|-----------|----------|
| **08-1（949 行）** | A～Q 各节展开过长，与 08-2 工单有大量重复（上线就炸 11 项、12～22 项在 08-2 已有对应 workitem）；「战略与深层风险索引」「十大深层风险」「演化与规模五类」等与 08-2/08-4 有交叉引用。 | ① **08-1 瘦身**：保留「系统级不变量」「首发前必读三类门禁」「闭合四列与 Gate」「定稿载体表」「上线就炸 11 项 + 12～22 项**摘要表**（仅问题+须写死结论+载体，删除写死句模板）」；A～Q 改为**节标题 + 一两句摘要 + 落点（08-2 workitem_id / 08-3/08-4 章节）**，详细检查项移入 **08-1 附录** 或仅保留「08-1 详细检查项（A～Q）」单独文档供深度审计用。② 目标：08-1 主体压到 **350～450 行**，其余进附录或 08-1-详细检查项.md。 |
| **08-2** | 定稿前/发版前检查为长列表（12 项+14 项+协议终极边界+自检七项），可读性一般。 | 保持列表，但可拆为「定稿前检查（必勾）」与「发版前检查（必勾）」两个子节，每项一行+落点链接，便于勾选。合并语义+Gate 后 08-2 略增，仍可接受。 |
| **08-4** | 188 行，已较紧；少量「写死」重复句可酌情合并。 | 瘦身空间有限；仅建议同一段内重复表述合并为一句+引用。 |
| **08-3** | 139 行，表为主。 | 无需瘦身。 |
| **Runbook** | 210 行，定稿表占一定篇幅。 | 无需瘦身；定稿表为必填项，保留。 |

**08-1 瘦身执行要点**（若采纳）：

- 保留：系统级不变量 5 条、首发前必读、闭合四列与 Gate、定稿载体与门禁产物、上线就炸 11 项及 12～22 的**简表**（问题+结论+载体列，无长模板句）、附录 GO/NO-GO Gate、使用说明。
- 压缩：A～Q 每节只保留「节名 + 1～2 句摘要 + 08-2/08-3/08-4 落点」；详细条目移至「08-1-附录-A至Q详细检查项.md」或 08-1 文末附录。
- 索引与深层风险：保留「战略与深层风险索引」「演化与规模五类」「去中心化协议深度检查」等**简要**段，详细表可移附录。

---

## 五、索引与引用修正建议

1. **00-文档索引**  
   - 08 系列表：按「08-1 主文档 → 08-2 工单与发版前审查 → 08-3 参数表 → 08-4 口径包 → 08-5 CI 落地 → Runbook」顺序列示。  
   - 若采用合并方案 A：删除对「08-2-语义一致性审查表」「08-2-Gate冲突矩阵与优先级」的独立行，改为「08-2 含语义一致性与 Gate 冲突矩阵两节」。  
   - **08 系列**：企业级审计结论已并入本 08-0（§十一～§十三），00 索引不另列「08-企业级审核报告」。

2. **发版前建议顺序**（08-2 或 00 索引）  
   - 若合并：④ 改为「08-2 发版前审查一（语义一致性）过表 + 发版前审查二（Gate 冲突矩阵）留档」。  
   - 08-5：所有「08-CI」「08-CI-落地说明」链接改为「08-5-CI与一致性落地说明」或保留旧文件名重定向说明（若保留 08-CI 文件名则仅统一索引表述）。

3. **07 §4.3、08-2 工单表内链**  
   - 凡指向「08-2-语义一致性审查表」「08-2-Gate冲突矩阵与优先级」的链接，改为「08-2-闭合工单与发版前审查#发版前审查一」等锚点。

---

## 六、建议执行顺序（若落地）

1. **仅审计、不改文件**：保留本文，在 00 索引中增加「08 系列审计见 08-0-系列审计-命名排序与合并瘦身」。
2. **仅重命名**：08-CI → 08-5；08-2 下两小文件 → 08-2a / 08-2b（或统一为「08-附录-语义与Gate审查」）；更新 00 与各文档内链。
3. **合并（方案 A）**：在 08-2 末尾增加两节，将语义表与 Gate 冲突矩阵内容迁入；删除原两文件；全局替换链接。
4. **08-1 瘦身**：按第四节压缩 08-1 主体，详细 A～Q 移附录或独立「08-1-附录-详细检查项」；更新 08-2/00 对 08-1 的引用说明。
5. **00 索引**：更新 08 系列表、发版前快速核对、当前 docs 目录结构；审计结论见本 08-0，无独立 08-企业级审核报告文档。

---

## 七、合并后 08 系列目标结构（方案 A + 08-5 重命名）

```
docs/
├── 08-0-系列审计-命名排序与合并瘦身.md   # 本审计（可选保留）
├── 08-1-战略与合规风险检查清单.md       # 主文档（可瘦身）
├── 08-2-闭合工单与发版前审查.md         # 工单表 + 语义一致性 + Gate 冲突矩阵
├── 08-3-参数与门禁表.md                 # SSOT
├── 08-4-对外口径包.md                   # PDP
└── 08-5-CI与一致性落地说明.md           # 原 08-CI（重命名）

ops/
└── RUNBOOK.md                           # 定稿载体
```

**不合并时**（仅重命名）：

```
docs/
├── 08-1-战略与合规风险检查清单.md
├── 08-2-闭合工单表.md
├── 08-2a-语义一致性审查表.md            # 或 08-附录-语义与Gate审查.md（含 Gate 冲突矩阵）
├── 08-2b-Gate冲突矩阵与优先级.md        # 若不与 08-2a 合并
├── 08-3-参数与门禁表.md
├── 08-4-对外口径包.md
└── 08-5-CI与一致性落地说明.md
```

---

## 八、08 系列企业级自检表（发版前逐项勾选）

定稿或发版前，建议按下列顺序对 08 文档做**企业级一致性检查**；未通过项须补正后再上线。

| 序号 | 检查项 | 落点 | □ 通过 |
|------|--------|------|--------|
| 1 | 08 系列文档顺序与索引一致（08-0→08-1→08-2→08-3→08-4→08-5→Runbook→evidence） | 00-文档索引 §08 系列 | |
| 2 | 08-1 优先闭合 6 项、上线就炸 11 项、#12～#22 与 08-2 工单一一对应 | 08-1、08-2 表 | |
| 3 | 08-3 关键 key 与 08-4 章节映射表完整；08-2 发版前审查一（语义一致性）表与 08-3 映射 key 对齐 | 08-3 映射表、08-2 发版前审查一 | |
| 4 | 08-4 第 1～8 章 + 协议终极边界与终局设计节无未写死占位；文档版本/定稿日期/签字已填 | 08-4 全文、文末 | |
| 5 | Runbook P0 最小必填项 9 项（含协议强制关闭）已填实；§1～§11 与 08-3/08-4 引用一致 | ops/RUNBOOK 定稿表、各节 | |
| 6 | 08-2 定稿前/发版前检查 ①～⑩ 全部勾选；发版前审查一、审查二已过或证据已留档 | 08-2 定稿前检查、发版前审查一/二 | |
| 7 | 00 索引「发版前快速核对」①～⑦ 与 08-2/08-4/Runbook 表述一致；无断链（链接可打开） | 00-文档索引、各 08 文档 | |
| 8 | Gate 汇总工单数与 08-2 各表 workitem 数量一致；W-PDP-SSOT-CONSISTENCY、W-GATE-CROSS-CHECK 有落点与 Evidence 要求 | 08-2 Gate 汇总、一致性与冲突检测 | |
| 9 | 术语一致：SSOT=08-3、PDP/对外口径包=08-4、evidence=GO_YYYYMMDD、Runbook §n 引用正确 | 全 08 系列 | |
| 10 | 无遗留「待定稿」「__________」「可选」等未说明占位（或已注明「定稿时填」及主责） | 08-3、08-4、Runbook 定稿表 | |
| 11 | **12 项企业级审计要点**已写死或落点：① 紧急 override+终极控制路径图 ② 文档 vs 链上 enforce ③ 仲裁员激励与裁决方向脱钩 ④ 质押覆盖率 worst-case ⑤ 事实金融服务/MSB/KYC 全覆盖应对 ⑥ 收益流闭环图 ⑦ 10× 争议触发阈值 ⑧ 群体攻击压力测试 ⑨ 时间篡改/Backend 不可随意改/NTP 双源 ⑩ 团队消失推演 ⑪ 治理币不可推翻宪法 ⑫ 声誉洗白防护 | 08-4、08-3、Runbook §6/§7/§8/§11、08-5 | |
| 12 | **企业级审计八层+最终五问+六项证明**：链上 Escrow 数学封顶、时间一致性（reorg disputeWindow/时区/fallback）、默认裁决击穿模拟、治理捕获与 constitutional guard、公司穿透、终局能力（协议 vs SaaS）、证据链攻击（S3 被封）、叙事一致性；五问（资金终态/时间操纵/治理改规则/经济击穿/公司实质控制）；六项证明各有落点 | 08-4「企业级审计分层与最终五问」、Runbook §6/§7/§11、08-3 | |
| 13 | **企业级三句话+四块深水区证明**：① 谁最终控制资金/规则/收益—答案写死且与 08-4 一致 ② **终极控制边界证明**（不可逆结构图）③ **收益证券隔离证明**（证券属性风险隔离声明闭环）④ **时间权威证明**（时间由谁定义+优先级矩阵+冲突解决图）⑤ **团队消失后自然终局证明**（无运营下的自然终局能力或明确依赖运营） | 08-4「企业级最终审计三句话」「四块企业级深水区证明」、Runbook §6/§7/§11 | |

*自检表可与 08-2 定稿前/发版前检查、00 发版前快速核对联合使用；企业级审计前建议至少完成 1～10 项勾选并留痕；**四块深水区证明**未闭合则审计不会给低风险。*

---

## 九、企业级技术审计（本轮）

**审计范围**：CI/脚本、08-3 可执行口径、evidence 校验、部署/运行时落点、路径与 key 一致性。

### 已修复项（本轮）

| 项 | 修复内容 | 落点 |
|----|----------|------|
| CI 脚本路径 | 由 `docs/08-3` / `docs/08-4` 改为精确文件名 `docs/08-3-参数与门禁表.md`、`docs/08-4-对外口径包.md`，避免 pathspec 匹配不到文件 | scripts/check-08-consistency.sh |
| CI 脚本 key 列表 | 补全 **chargebackPolicy**，与 08-3 映射表一致 | 同上 |
| 08-4 版本行校验 | 增加「文档版本」+ 版本号（v[0-9] 或 CI 校验用）双条件，降低格式误判 | 同上 |
| 全局变更指数 | 写死可执行口径：30 日滚动窗口内 08-3 变更记录条数（每条计 1）≤ paramChangeMaxPer30d；执行处 Runbook §10 / 08-3 变更记录 | 08-3、Runbook §10 |
| evidence manifest | 必填字段表（gate/date/artifacts/sign_off）+ 校验脚本 scripts/validate-evidence-manifest.sh（依赖 jq） | evidence/README.md、scripts/validate-evidence-manifest.sh |
| 部署/运行时校验落点 | 明确「仓库内暂无部署/Backend 校验时须在 Runbook §10 或架构文档注明落点与已实现/待实现」 | 08-5 §4 |

### 本轮技术审计结论（剩余技术问题 → 已闭合）

| # | 类别 | 原问题 | 闭合措施 |
|---|------|--------|----------|
| 1 | 依赖 | validate-evidence-manifest.sh 依赖 jq；无 jq 时 SKIP | 保持；过门环境预装 jq 或人工核对，见 evidence/README |
| 2 | 实现落点 | 部署前 08-3、Backend 启动 SSOT 校验无仓库内实现 | Runbook §10 已写死「部署前 08-3 校验与 Backend 启动 SSOT 校验」节，须注明已实现/待实现及脚本路径；08-5 §4 落点说明已补 |
| 3 | 正则 | grep KEYS 可能误触 | 接受（宁可误触）；未改 |
| 4 | 01/02 | 01/02 与 08-4 交叉核对 | 发版前 08-2 语义一致性审查可增 01/02 行；未改表结构 |
| 5 | 08-2 CI 描述 | 清单写「docs/08-3」与脚本实际文件名不一致 | 已改为 docs/08-3-参数与门禁表.md、docs/08-4-对外口径包.md，并补「CI 校验 key 列表以脚本为准、映射表增删 key 须同步脚本」 |
| 6 | 映射 key 双处维护 | 08-3 映射表与脚本 KEYS 两处 | 08-2、08-3 已写死「CI 校验 key 列表以 scripts/check-08-consistency.sh 为准；本表增删 key 须同步该脚本」 |
| 7 | evidence 模板放行 | 模板 date=YYYY-MM-DD 未区分 | validate-evidence-manifest.sh 已加：gate=Gate-X 且 date=YYYY-MM-DD 时视为模板仅 WARN 退出 0；真实 bundle 须具体日期 |
| 8 | Fork PR base ref | fork PR 可能 base.sha 不可用 | workflow 注释与 08-5 已写「设计假设同仓 PR；fork PR 失败可重跑或维护者确认」 |

**结论**：上述技术项已通过文档写死、脚本修正或约定注明闭合；无未闭合阻断性技术缺陷。

---

## 十、前端 / 后端 / 链上 / 智能合约 技术缺口（实现与 08/01/02 对齐）

以下为**实现层**与 08 系列、01/02 文档约定的技术性缺口；定稿或实现时须逐项闭合或注明「待实现」。

### 链上 / 智能合约

| # | 问题 | 说明 | 落点 |
|---|------|------|------|
| 1 | **contracts/ 无 Solidity 合约** | 02 约定 `contracts/` 为 Escrow/Staking/Registry（Solidity）；仓库内 **contracts/ 为空或不存在**。08-4 要求的「不可逆结构图证明」「01/02 合约文档」无法从代码出具。 | 01 §4、02 §十、08-4 监管穿透模拟、Runbook §7；待实现或注明「合约在独立 repo/待开源」 |
| 2 | **Immutable Core / Proxy 边界无代码对应** | 01 企业级审计必问：Proxy 能否换 Implementation、admin key、紧急 override。无合约代码则无法从实现证明。 | 01 §5 表、08-4 第 2 章、Runbook §7 |

### 后端（crates/api、04）

| # | 问题 | 说明 | 落点 |
|---|------|------|------|
| 3 | **Backend 未引用 08-3/SSOT** | 08-5、Runbook 要求 Backend 启动时校验或打印 SSOT 版本/hash、与 08-3 关键 key 比对。**crates 内无 08-3 或 SSOT 相关读取**。 | 08-5 §4、Runbook §10；实现时从配置或 08-3 约定加载 finalityN、disputeWindowMin、arbFeeBase 等，或注明「待实现」 |
| 4 | **运行参数与 08-3 未单源** | 业务参数（仲裁费、证据保留期、争议窗口等）若在代码或 env 硬编码，易与 08-3 脱节。须约定**运行时参数以 08-3 为 SSOT**，配置/启动时加载或校验。 | 04、08-3、Runbook §11 SSOT 运行时校验 |

### 前端（crates/web、05）

| # | 问题 | 说明 | 落点 |
|---|------|------|------|
| 5 | **金额/汇率展示与 08-3 一致** | 08-3 fxDisplayPolicy=chain_only；前端展示金额、汇率须与 08-4 第 5 章、08-3 一致，避免「仅链上」承诺与实现不符。 | 05、08-3 fxDisplayPolicy、08-4 第 5/7 章 |
| 6 | **可替代入口与可验证发布** | 08-4 第 7 章、W-Q6-FE：≥2 入口、manifest+hash+可复现。实现时须有构建产物与校验步骤。 | 05、07、08-2 W-Q6-FE |

### 领域层（crates/core）与 01 状态机

| # | 问题 | 说明 | 落点 |
|---|------|------|------|
| 7 | **OrderState 与 01 状态机不一致** | 01 §1 规定订单状态含 **Accepted, Refunded, PartiallyRefunded, Slashed** 等；**core 的 OrderState 仅有 Created, Escrowed, Completed, Disputed, Cancelled**，缺 Accepted 与三种资金终态。实现须与 01 状态机表一致。 | crates/core/src/escrow.rs、01 §1 订单状态机 |
| 8 | **StakeTier 与 08-3 数值不一致** | 08-3 stakeTierThresholds=500,2000,10000；**已修复**：core 已改为 Standard(500)/Premium(2000)/Enterprise(10000) 及 order_cap()，见本轮已修复表。 | crates/core/src/staking.rs、08-3 stakeTierThresholds |

### 建议闭合方式

- **链上/合约**：在 01 或 Runbook §7 注明「合约当前在 X repo/待开源」或补齐 contracts/ 与 08-4/01 一致的设计与实现；不可逆结构图可先以设计图落 evidence。
- **后端**：04 或架构文档写死「Backend 启动须加载/校验 08-3 约定参数或版本」；实现时在 api 或配置层接入 08-3 关键 key 或 SSOT 版本校验。
- **前端**：05 或 07 写死「金额与汇率展示以 08-3 fxDisplayPolicy 为准」；构建与可验证发布见 07 §4.3。
- **core**：OrderState 补全 Accepted、Refunded、PartiallyRefunded、Slashed 与 01 一致；StakeTier 数值与 08-3 一致或改为从配置读取。

### 本轮已执行：08 重排与全库技术检查

- **08 序号统一**：**08-CI** 已重命名为 **08-5-CI与一致性落地说明.md**，与 08-1～08-4 统一数字序号；原文件已删除，全库引用已更新为 08-5（00、04、07、08-2、08-4、Runbook、README、crates/api、08-0）。
- **00 索引**：08 系列阅读顺序已更新为 **08-0 → 08-1 → 08-2 → 08-3 → 08-4 → 08-5 → Runbook → evidence**；版本表与目录结构已列 08-5。
- **全库技术检查**：① 脚本与 workflow 使用 `docs/08-3*.md` / `docs/08-4*.md` 及脚本内精确路径 `08-3-参数与门禁表.md`、`08-4-对外口径包.md`，无路径错误。② 08-1、08-2 中「待定稿」「__________」为业务/定稿时填写项，已注明主责或「定稿时填」，非未说明占位。③ 08-2 发版前审查表「审查人/日期/结论」「最后更新/评审日期/Evidence 路径」留空为发版前人工填写，符合 08-0 自检表第 10 项（已注明「定稿时填」即可）。④ 无断链：08-CI 旧链接已全部替换为 08-5。

### 本轮已修复/落点（技术性问题优化）

| # | 08-0 §十 项 | 闭合措施 |
|---|-------------|----------|
| 7 | OrderState 与 01 不一致 | **已修复**：crates/core OrderState 已补全 Accepted、Refunded、PartiallyRefunded、Slashed；can_review 改为 is_final_financial_state()，与 01 §4/04 §2.2 一致 |
| 8 | StakeTier 与 08-3 数值不一致 | **已修复**：crates/core StakeTier 改为 Standard(500)/Premium(2000)/Enterprise(10000)，与 08-3 stakeTierThresholds 一致；新增 order_cap() 与 stakeToOrderCapMap 对应 |
| 3～4 | Backend 未引用 08-3/SSOT、运行参数未单源 | **已落点**：04 §四 增加「运行时参数与 08-3 SSOT」约定；Runbook §10 注明当前「待实现」及落点；crates/api 启动时读取 env SSOT_VERSION 并打印（实现完整校验时在此扩展） |
| 5～6 | 前端 fxDisplayPolicy、可验证发布 | **已落点**：05 开篇写死金额/汇率以 08-3 fxDisplayPolicy 为准、可验证发布要求；07 §4.3 发版前行增加「可验证发布」与 08-4/ W-Q6-FE 对应 |
| 1～2 | contracts/ 无合约、Immutable Core 无代码 | **已落点**：02 §十 增加「实现状态」注明 contracts/ 为设计态/待实现或独立 repo；Runbook §10 注明部署前 08-3 校验—待实现（当前仓库无 contracts/） |

---

## 十一、企业级技术文档审计报告

**审计日期**：见 00 文档版本与最后更新。**审计范围**：全库技术文档（01～07、08-0～08-5、Runbook、evidence、scripts、workflow）与实现（crates/core、api、web；contracts/）的一致性、可追溯性、断链与缺口。**审计依据**：01 P0/12 缝/17 条/系统级不变量、02 架构与仓库骨架、03 业务规则、04/05/06 实现落点、07 阶段与发版前检查、08 系列定稿载体与 CI。

### 11.1 审计维度与结论

| 维度 | 检查项 | 结论 | 备注 |
|------|--------|------|------|
| **01～07 可追溯** | 01 引用 02/03/04/05/06/07/08 均有对应节；04/05/06 与 01 一致性表、02 核对表一致 | ✅ 通过 | 01 §1 状态机与 core OrderState 已对齐（Accepted/Refunded/PartiallyRefunded/Slashed）；03/04 评价仅资金终态一致 |
| **08 系列顺序与引用** | 08-0→08-1→…→08-5→Runbook→evidence；无 08-CI 残留链接；08-5 与 08-3/08-4/ Runbook 引用正确 | ✅ 通过 | 08-CI 已统一为 08-5 |
| **08-3 与 CI 脚本** | 映射表 key 与 scripts/check-08-consistency.sh KEYS 一致；08-3/08-4 精确文件名在脚本与 workflow 中一致 | ✅ 通过 | 15 个映射 key；路径为 docs/08-3-参数与门禁表.md、docs/08-4-对外口径包.md |
| **08-4 版本行** | 文末含「文档版本（CI 校验用）」及版本号（如 v20250220） | ✅ 通过 | CI 可机读校验 |
| **evidence** | manifest 必填 gate/date/artifacts/sign_off；validate-evidence-manifest.sh 与 README 一致；模板 Gate-X+YYYY-MM-DD 仅 WARN | ✅ 通过 | 依赖 jq；无 jq 时 SKIP |
| **Runbook §10** | 部署前 08-3、Backend 启动 SSOT 校验—已实现/待实现已注明；当前落点写死 | ✅ 通过 | 待实现；落点 crates/api + env SSOT_VERSION |
| **仓库骨架与文档** | 01 §8、02 §二、README 目录一致；contracts/、chain-client 存在性 | ✅ 已修正 | README 已改为 Escrow/Staking/Registry（Reputation 可选）；contracts/、chain-client 当前无代码，02 §十、08-0 §十已注明 |
| **实现与 01/08-3** | core OrderState、StakeTier 与 01/08-3 一致；api 启动 SSOT 占位 | ✅ 通过 | 见 §十 本轮已修复表 |
| **断链** | 00 索引、08-2、07 §4.3、05/06 等内部链接可解析；无指向已删文件（08-CI、08-2-语义/Gate 独立文件） | ✅ 通过 | 08-2 语义/Gate 已并入 08-2 正文；审计结论见本 08-0 §十一～§十三 |

### 11.2 待解决/待实现（非阻断）

| # | 类别 | 描述 | 建议 |
|---|------|------|------|
| 1 | 链上/合约 | contracts/ 无 Solidity；Immutable Core/Proxy 无代码证明 | 02 §十、Runbook §10 已注明设计态/待实现；实现时补齐或注明独立 repo |
| 2 | 后端 | Backend 完整 SSOT 校验（当前仅 env SSOT_VERSION 打印） | 实现时从配置/08-3 加载关键 key 并校验或拒绝启动 |
| 3 | 前端 | fxDisplayPolicy、可验证发布为文档约定，前端实现时落地 | 05、07 §4.3 已写死；构建产物与 manifest 在 Phase 4 定稿 |
| 4 | 可选依赖 | chain-client 未建；01/02 标为可选 | 链上对接时再建 crates/chain-client 或 api 内嵌 |
| 5 | jq 依赖 | validate-evidence-manifest.sh 无 jq 时 SKIP | 过门环境预装 jq 或人工按 evidence/README 核对 |

### 11.3 审计结论

**企业级技术文档与实现**：**通过**。01～07 与 08 系列可追溯、08 序号统一、CI/脚本与 08-3/08-4 一致、evidence 与 Runbook 落点明确；core/api 与 01/08-3 已对齐；README 与 01/02 骨架已统一。**剩余项**为合约未实现、Backend 完整 SSOT 校验待实现、前端可验证发布待实现，均已注明落点或「待实现」，无未闭合阻断性技术缺陷。建议：发版前按 08-0 自检表 §八、00 发版前快速核对逐项勾选；合约与链上对接时再闭合 §十 链上/合约项。

---

## 十二、深度企业级技术审计（现实世界顶级标准）

**审计标准**：按现实世界顶级企业/监管审计要求，对**全文档 + 全实现**做一致性、可追溯性、安全与合规、缺口四维检查。**范围**：01～07、08-0～08-5、Runbook、evidence、scripts、workflow；crates/core、api、web；contracts/（存在性）；12 缝/17 条/系统级不变量/08-3 26 key 落点。

### 12.1 前端（05/06、crates/web）

| 检查项 | 标准 | 结论 | 备注 |
|--------|------|------|------|
| 框架与骨架 | 01/02/05：Yew、Web+DApp 同源、crates/web | ✅ 一致 | lib.rs 为 Yew 入口，仅占位页 |
| 页面/路由/API 调用 | 05 §四§五：auth、me、导游、订单、争议、证据 | ⚠️ 未实现 | 前端仅有标题占位，无路由、无 api 模块、无 dapp 钱包；05/06 为设计，实现时须按 04 接口与 01 §7 钱包签落地 |
| 金额与汇率展示 | 08-3 fxDisplayPolicy=chain_only；05 已写死 | ✅ 文档闭合 | 实现时前端须从 Backend/配置读取并与 08-3 一致 |
| 可替代入口与可验证发布 | 08-4 第 7 章、W-Q6-FE：≥2 入口、manifest+hash+可复现 | ✅ 文档闭合 | 07 §4.3 已写死；构建与校验步骤在 Phase 4 定稿 |
| 超时/争议窗口展示 | 01 §10 12 缝 #3、03 §1.3；前端从 API 获取 | ✅ 文档一致 | 03 未单独表写死 K/M 天数，由 08-3 autoCompleteDelay/disputeWindowMin 与合约/配置提供 |

### 12.2 后端（04、crates/api）

| 检查项 | 标准 | 结论 | 备注 |
|--------|------|------|------|
| API 路由与 04 §三 一致 | 04 规划认证、me、导游、订单、争议、证据等完整 v1 路由 | ❌ 严重不符 | **crates/api 仅实现 /health、/api/v1/guides 占位**；无 auth、orders、disputes、evidence、idempotency-key；实现时须按 04 逐项落地 |
| 幂等与 traceId | 01 §10 17 条 #14 幂等键；01 §9 traceId 贯通 requestId→txHash→logIndex | ❌ 未实现 | api 无 requestId/idempotency-key 处理、无 traceId；04 已写死，实现时必加 |
| 身份 P0-1、代付 P0 | 01 §2/§7：签名钱包与主身份校验；后端不持私钥/不代签 | ✅ 文档闭合 | 实现时鉴权与钱包校验须与 01 一致 |
| SSOT/08-3 运行时 | 04 §四、08-5 §4、Runbook §10：启动加载/校验 08-3 或版本 | ⚠️ 占位 | api 启动读取 env SSOT_VERSION 并打印；完整 key 校验待实现 |
| 订单状态仅链事件驱动 | 01 §3、17 条 #12：Paid/终态仅由链上事件驱动 | ✅ 文档闭合 | 04 §二 2.2 已写死；实现时 indexer/对账须严格按 01 |

### 12.3 链上/智能合约（01 §4/§5、02 §十、08-4、Runbook §7）

| 检查项 | 标准 | 结论 | 备注 |
|--------|------|------|------|
| contracts/ 存在且与 01/02 一致 | Escrow/Staking/Registry（Solidity）；01 §8 骨架 | ❌ 无代码 | 仓库内 **contracts/ 为空**；02 §十、08-0 §十已注明设计态/待实现 |
| Escrow 无 admin/无 emergency withdraw | 08-4、01 企业级审计必问：无 admin override、无 emergency withdraw、无 delegatecall 可换逻辑 | ⚠️ 待合约落地证明 | 08-4 已要求定稿时写死并落 01/02/Runbook §7；**合约未存在前无法从代码出具证明**，定稿时可先以设计承诺+终极控制路径图落 evidence |
| finalityN / disputeWindow / autoComplete | 01 §5、08-3：finalityN=12；disputeWindowMin 86400；autoCompleteDelay 604800；01 不等式 disputeDeadline≥autoCompleteAt | ✅ 文档一致 | 08-3 与 01 不等式一致；合约/配置实现时须校验 |
| 事件与 checkpoint | 01 §5 四类事件；checkpoint(blockNumber,logIndex)；reorg 重放 | ✅ 文档闭合 | 实现时 event 表与投影须按 01/02 §七 |

### 12.4 08 系列、Runbook、CI/evidence

| 检查项 | 标准 | 结论 | 备注 |
|--------|------|------|------|
| 08-3 26 key 与 08-4 映射、CI 脚本 KEYS | 映射表 15 key 与 check-08-consistency.sh KEYS 一致；08-4 版本行可机读 | ✅ 通过 | 脚本精确路径、VERSION_MARKER+版本号校验已落实 |
| Runbook §10 部署/Backend SSOT | 已实现/待实现须注明、当前落点写死 | ✅ 通过 | 当前落点：Backend 待实现（api+SSOT_VERSION）；部署前 08-3 待实现（无 contracts/） |
| evidence manifest 与校验脚本 | 必填 gate/date/artifacts/sign_off；模板与真实 bundle 区分 | ✅ 通过 | validate-evidence-manifest.sh 已区分 Gate-X+YYYY-MM-DD 模板 |
| 12 缝→参数可追溯 | 01 要求每条缝写死；数值分散在 08-3/03/04/Runbook | ⚠️ 建议增强 | **建议**：08-2 或 01 增加「12 缝→08-3/03 参数 key 对照表」，便于实现与审计一键核对 |
| 17 条证据产物 | 每条对应单测/E2E/runbook 可产出 Evidence artifact | ⚠️ 实现期 | 01 §10 表已列 artifact；实现时逐条落单测/E2E/对账脚本 |

### 12.5 安全与合规（顶级必查）

| 检查项 | 标准 | 结论 | 备注 |
|--------|------|------|------|
| 链上：重入、effects-before-interactions | 01 §5 十一、17 条：nonReentrant、仅 ERC20 拒 ERC777 | ✅ 文档闭合 | 合约实现时必守 |
| 链上：allowlist、后端不绕过 | 01 §5 九、禁止行为「后端绕过 allowlist」 | ✅ 文档闭合 | 04 已写死；实现时 allowlist 校验在链与后端双端 |
| 时间双轨与 serviceStartTimeSource | 08-3 backend_evidence；08-4 第 3 章、Runbook §11 时间优先级矩阵 | ✅ 文档闭合 | 裁决以证据+服务器时间为准；窗口以链为准 |
| 证据保留 1095 天、hash 永久、司法协助 | 08-3 evidenceRetentionDays；08-4 第 3 章删除与司法 | ✅ 文档闭合 | 实现时存储与删除策略须一致 |
| OFAC/制裁 ofacHitPolicy | 08-3 只读冻结；08-4 第 8 章、申诉 30 天 | ✅ 文档闭合 | 实现时命中策略与申诉路径须一致 |

### 12.6 待闭合清单（按优先级）

| 优先级 | 问题 | 落点 | 建议 |
|--------|------|------|------|
| P0 | **API 与 04 严重不符**：仅 health+guides 占位，无 auth/orders/disputes/证据/幂等/traceId | crates/api、04 §三 | **已补齐**：04 §三 全量路由已挂 501 占位；x-request-id（traceId）中间件已加；STRICT_SSOT 可选启动校验。实现时将占位替换为真实 handler（幂等、证据路径等）。 |
| P0 | **contracts/ 无代码**：Escrow/Staking/Registry 无法从代码证明无 admin/无 emergency withdraw | 02 §十、08-4、Runbook §7 | **已补齐**：contracts/README.md 已建，设计承诺与 01/02/08-4 一致；实现后出具不可逆结构图与 08-4 承诺 |
| P1 | Backend 完整 SSOT 校验（当前仅 SSOT_VERSION 打印） | Runbook §10、08-5 §4、crates/api | 从配置/08-3 加载关键 key 并校验或拒绝启动 |
| P1 | 12 缝→08-3/03 对照表 | 01 §10、08-2 或 08-3 | **已落实**：01 §10 已增加「12 缝→08-3/03 参数 key 对照表」 |
| P2 | 前端路由、api 模块、dapp 钱包、可验证构建 | crates/web、05、07 §4.3 | **已补齐**：web 路由骨架（首页/auth/me/orders/disputes）、api 模块（get_health、get_me 占位）已就位；Phase 4 按 05/06/04 落地业务与 dapp 钱包 |
| P2 | chain-client 可选未建 | 01 §8、02 | 链上对接时再建或 api 内嵌 |
| P2 | 17 条证据产物逐条落单测/E2E/runbook | 01 §10 表、07 发版前 | 实现时每条可产出对应 artifact |

### 12.7 深度审计结论

**按现实世界顶级标准**：**文档体系与 08/01/02/03/04 一致性、08-3/08-4/CI/evidence/Runbook 闭合度**—**通过**。**实现层**：**core** 与 01/08-3 已对齐；**api** 已与 04 §三 全量路由对齐（501 占位）、x-request-id（traceId）中间件与 STRICT_SSOT 可选校验已加，实现时替换占位并加幂等；**web** 已具备路由骨架与 api 模块占位；**contracts/** 已建 README 与设计锚点，实现后出具不可逆结构图与 08-4 承诺。**建议**：实现阶段将 api 占位换真实 handler（幂等、证据路径）、web 接业务与 dapp 钱包、contracts 落 Solidity。**当前无阻断性文档缺陷**；结构缺口已补齐，剩余为业务实现。

---

## 十三、docs 企业级符合性检查

**检查范围**：docs/ 下全部 14 篇 Markdown；企业级标准：索引与版本统一、可追溯、无断链、文档控制四要素、08 系列与 00 一致、跨文档引用路径正确。

### 13.1 符合项（达标）

| 维度 | 结论 | 说明 |
|------|------|------|
| **索引与顺序** | ✅ | 00 文档列表与阅读顺序完整；08 系列 08-0→08-5→Runbook→evidence 明确；目录结构与实际 docs/ 一致 |
| **版本与维护** | ✅ | 00 版本表含 14 篇；各文档开篇或文末均有「文档版本与最后更新见 00」或「见 [00-文档索引]」 |
| **文档控制四要素** | ✅ | 01～07、08-0～08-4 均具备：受众与用法、文档维护责任、版本见 00、内容与结构/本文目录 |
| **可追溯与权威链** | ✅ | 01 P0/12 缝/17 条为权威；02/03/04/05/06/07 与 01 核对表、08-3 与 08-4 映射、08-5 与脚本 KEYS 一致 |
| **内部链接（docs 内）** | ✅ | 01～07、08-0～08-5 之间均使用相对路径 `xx-名称.md` 或 `08-x-名称.md`，无 08-CI 残留 |
| **08 系列序号** | ✅ | 08-CI 已统一为 08-5；00、04、07、08-2、08-4、08-0 等引用均为 08-5 |
| **锚点引用** | ✅ | 00→08-2 发版前审查一/二、07/05→08-1 附录 GO/NO-GO Gate 等锚点与目标标题一致 |
| **08-3 key 数量** | ✅ | 08-3 表内 26 key 与 00/08-2 表述「26 key」一致 |

### 13.2 问题与已修复

| # | 问题 | 位置 | 处理 |
|---|------|------|------|
| 1 | Runbook 链接从 docs 内指向 `ops/RUNBOOK.md` 会解析为 docs/ops/，导致断链 | 08-2、04、01 | 已改为 `../ops/RUNBOOK.md` |

### 13.3 待改进（已落实）

| # | 项目 | 状态 |
|---|------|------|
| 1 | **版本表未填** | ✅ 已优化：00 版本表下已增加说明「下表『—』表示待定稿；发版前须填实版本号与最后更新日期」 |
| 2 | **00 文末配套** | ✅ 已落实：00 文末已补「08 系列 08-0～08-5 见上表」 |
| 3 | **evidence 路径说明** | ✅ 已落实：00 证据目录行、08-2 证据目录处已注明「路径以仓库根为准」 |
| 4 | **12 缝→参数对照表** | ✅ 已落实：01 §10 在 12 缝表后已增加「12 缝→08-3/03 参数 key 对照表」 |

### 13.4 结论

**docs 文件夹企业级符合性**：**符合**。索引、版本声明、文档控制、可追溯性、08 系列与 00 一致、内部链接与锚点均达标；**已修复** 3 处 Runbook 相对路径（08-2、04、01）。**待改进** 4 项均已落实（版本表说明、00 文末 08 系列、evidence 路径说明、12 缝→08-3/03 对照表）；发版前按 00「发版前快速核对」与 08-0 §八 自检表勾选即可。

---

## 十四、世界级文档审计问题清单

**审计标准**：按世界级项目/顶级工程师标准，对 docs 全量文档做**结构、一致性、可追溯、可执行、占位与缺口、术语与格式**六维审计。**结论**：文档体系可追溯、08/01～07 权威链清晰、CI/脚本与 08-3 映射一致；以下为**问题与待闭合项**，按优先级与类别列出。

### 14.1 P0（发版前必须闭合或明确）

| # | 问题 | 状态 | 说明 |
|---|------|------|------|
| 1 | **发版前审查表留空未标注「定稿时填」** | ✅ 已修复 | 08-2 审查一/二所有留空处已加「（定稿时填）」 |
| 2 | **08-4 定稿前仍有占位即不得闭合** | ✅ 已落实 | 00 发版前快速核对①已注明「08-4 版本号、定稿日期、法务/运营签字缺一不可」 |
| 3 | **08-2 发版前审查一未覆盖全部映射 key** | ✅ 已修复 | 08-2 审查一表已扩展为 11 行，覆盖 08-3 映射表 15 key（含 pauseCooldown/pauseAllowlist、evidence 三 key、arbFee、fxDisplayPolicy、chargebackPolicy 等），第 11 行为其余 key 定稿时逐项核对并留档 |

### 14.2 P1（强烈建议修复）

| # | 问题 | 状态 | 说明 |
|---|------|------|------|
| 4 | **章节引用格式不统一** | ✅ 已落实 | 00 归类说明下已增加「章节编号约定」：01 用 §1～§10，02～06 用 §一～§十三，07/08 混用 |
| 5 | **08-1 体量过大、未瘦身** | ✅ 已落实 | 00 企业级审计/阅读导航已写明「以 08-2 工单表与 Gate 为主入口，08-1 为详细检查清单」 |
| 6 | **版本表无实际版本号** | ✅ 已落实 | 00 版本表说明已增加「08-4 版本号须与文末『文档版本（CI 校验用）』一致」及「下表『—』表示待定稿；发版前须填实」 |
| 7 | **08-1 待定稿项无优先级汇总表** | ✅ 已修复 | 08-1 使用说明前已增加「首发前待定稿汇总（缺口视图）」节，明确以 08-2 工单表为唯一缺口视图 |

### 14.3 P2（改进与一致性）

| # | 问题 | 状态 | 说明 |
|---|------|------|------|
| 8 | **04 Phase 与 07 Phase 表述不完全对齐** | ✅ 已修复 | 04 §五 首段已增加「Phase 0（架构锁定）、Phase 5（风控与运营就绪）定义及产出见 07 §二」 |
| 9 | **01 §10 缝与 17 条对应为文字描述** | ✅ 已修复 | 01 §10 审计前检查清单后已增加「12 缝→17 条验收编号对照表」 |
| 10 | **evidence 目录树与 00 表述** | ✅ 已修复 | 00 目录结构 evidence 段已增加「DR-YYYYQX-0N/（演练产物，可选）」 |
| 11 | **脚本 KEYS 与 08-3 映射表 key 数量** | — 无需修改 | 已一致；发版前复核即可 |

### 14.4 实现与文档缺口（已记录于 §十二，此处汇总）

| # | 问题 | 说明 |
|---|------|------|
| 12 | **API 结构已对齐，业务未实现** | crates/api 已与 04 §三 全量路由对齐（501 占位）、x-request-id（traceId）与 STRICT_SSOT 已就位；CORS/PORT/请求体限制已可配置。缺口：占位换真实 handler、幂等键、证据路径等，按 04 与 01 §10 17 条落地 |
| 13 | **contracts/ 为设计态** | 无 Escrow/Staking/Registry 实现代码；README 与设计锚点已建；08-4「无 admin/无 emergency withdraw」待实现时从代码证明；02 §十、Runbook §7 已注明设计态/待实现 |
| 14 | **前端骨架已就位，业务未实现** | crates/web 已有路由骨架（首页/auth/me/orders/disputes）与 api 模块占位（get_health、get_me）；缺口：业务页面、dapp 钱包、与 04 接口对接，按 05/06 与 01 §7 落地 |

### 14.5 审计结论（世界级标准）

**文档层**：**通过**。00～07、08-0～08-5、Runbook、evidence 约定与 01 权威链、08-3/08-4/CI 一致；可追溯性、文档控制四要素、12 缝→08-3 对照表、evidence 路径说明已就位。**问题清单**：P0 共 3 项 **已全部修复/落实**；P1 共 4 项 **已全部落实**；P2 共 4 项 **已修复 3 项**（04 Phase、01 12 缝→17 条表、evidence DR 目录），第 11 项为发版前复核。**实现缺口** 3 项已记录于 §十二，属实现阶段闭合项。

---

*本文与 [00-文档索引](00-文档索引.md)、[08-1-战略与合规风险检查清单](08-1-战略与合规风险检查清单.md)、[08-2-附录-闭合工单表](08-2-附录-闭合工单表.md) 配套。*
