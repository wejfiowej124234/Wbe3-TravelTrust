# 前端总览（Rust / Yew）

本文是 **Rust 前端（Yew/WASM）** 的总览：技术选型、目录骨架、页面与模块，「预约 → 确认订单 → 上链 → 钱包付代币」在前端的落点，以及 **Web 与 DApp 业务数据同源**约定。与 [01-总库总览](01-总库总览.md)、[02-架构设计](02-架构设计.md)、[04-后端与API](04-后端与API.md) 配套；UI 事实、代付 P0、EIP-712 以 01 为准，表现层 = 02 的 crates/web。

**与 01/02/04 对应**：01 §7 DApp/钱包/EIP-712/代付 P0 → 本文 DApp 与支付落点；02 表现层 = crates/web，API 由本文 `api/` 模块调用；04 认证、`/api/v1/me`、统计口径见本文 §六、§七。03 业务规则（超时/争议窗口）与前端展示一致见 [03-业务流程与风控](03-业务流程与风控.md)、本文 §二。业务数据同源见 01 §9、02 §八、[06-DApp架构总览](06-DApp架构总览.md)。

**技术选型（已锁定）**：前端框架 **Yew**（Rust→WASM），与 01/02/07 表现层一致；一个前端、Web + DApp 两种模式、业务数据同源。详见 §三。

**内容与结构**：§一 前端在整体里的位置 · §二 业务流程在前端体现 · §三 技术选型 · §四 仓库骨架 · §五 模块职责 · §六 账号与个人中心 · §七 关键流程（代币支付）· §八 与总库总览关系 · **§九 UI/UX 设计风格与页面层级规划**（设计语言、四层结构、关键页面与 01～04 对应、**9.0.5 UI/UX 顶级要求与细节规范**）· §十 企业级审计标注（9.1～9.5）。实现与对接前建议先读 01、02、04。

**前端文档用法**：本文（05）为**唯一前端总览**，开发时以 05 为主。**仅做普通 Web 页（不连钱包）**：05 + 04（接口）+ 01/03（业务与风控）即可。**做 DApp（连钱包、支付/质押/争议）**：05 + [06-DApp架构总览](06-DApp架构总览.md) 配合；接口与业务仍看 04、01、03。无其他独立前端配套文档；组件与 UI/UX 要求均在本文档内。

**受众与用法**：前端与 DApp 实现、后端/产品对接人。建议先读 01、02、04，必要时读 [03-业务流程与风控](03-业务流程与风控.md)（超时/争议窗口与前端展示一致）；实现时与 [07-开发流程与顺序](07-开发流程与顺序.md) 配合。**文档维护责任**：前端或技术负责人；页面/模块/API 调用变更须与 04 接口一致，并同步 01/02 及 03 相关节（超时/争议窗口等与前端展示相关）；涉及 DApp 展示或 api/dapp 分工时同步 [06-DApp架构总览](06-DApp架构总览.md)。当 01 §7/§9/§10 前端相关条款变更时，建议 01 维护者同步本文。文档版本与最后更新见 [00-文档索引](00-文档索引.md)。

**05 与 01/02 关键一致性核对**（维护时以 01 为权威，05 不得与之冲突）：

| 核对项 | 01 位置 | 05 位置 | 结论 |
|--------|---------|---------|------|
| DApp/钱包/EIP-712/代付 P0 | 01 §7 钱包、EIP-712、代付（后端不持私钥/不代签） | §二、§七 钱包签、代币支付；不代付、不托管 | 一致 |
| UI 事实 P0：已支付仅来自链上/对账 | 01 §7 已支付仅来自链上 Paid/对账；pending 展示 confirmations | §二 业务数据以 API 为准、链上仅资金；§七 支付由钱包签 | 一致 |
| Web 与 DApp 业务数据同源 | 01 §9；02 §八 | §二 唯一数据源=后端 API、Web 与 DApp 共用 api/ | 一致 |
| 表现层 = crates/web | 01 §8 总库；02 表现层 | 开篇、§四 仓库骨架 crates/web | 一致 |
| 注册/登录、个人中心 | 01 §2；04 认证、/me | §四 pages/auth、§六 pages/me、与 04 一致 | 一致 |
| 预约→确认→上链→钱包付代币 | 01 业务流程、§7 支付=用户签 | §二 流程图、§七 确认订单页/钱包付旅行费用 | 一致 |
| 导游质押、确认完成、发起争议（openDispute）钱包签、仲裁执行仅调 API | 01 §8 数据流；01 §7 deposit/confirm/openDispute 须钱包签；02 链上·用户签 | §二 导游端、§七 2/3/4/5 | 一致 |
| 钱包换绑与已支付订单（12 缝 #11） | 01 §7 Paid 后换钱包=dispute 或新单；01 §10 12 缝 #11 UI+文档 | §六 绑定/解绑钱包；展示与交互以 01 为准 | 一致 |

**05 与 01 总览主题符合性**（实现与审计时须与 01 总览主题保持一致）：

| 01 总览主题/约束 | 05 实现对应 | 所在节 |
|------------------|-------------|--------|
| 用户与账号、注册/登录、个人中心 | auth/ 注册登录；me/ 资料、绑定钱包、我的订单/评价/统计 | §四、§六 |
| DApp/钱包/EIP-712/代付 P0 | dapp/ 钱包签、代币支付；不代付；EIP-712 以 01 为准 | §二、§七 |
| Web 与 DApp 业务数据同源 | 业务数据唯一来自 API；Web 与 DApp 共用 api/ 模块 | §二 |
| 表现层、仓库骨架 web | crates/web、pages、api、dapp、components | §四、§五 |
| 订单/导游/争议展示以 API 为准 | api/ 调用后端；不因连接钱包分源 | §二、§五 |
| 证据/争议展示、档期 | 争议列表与裁决见 api/disputes、pages/arbitrator；档期从 API 获取，不单独维护 | §二、§四、§五 |

---

## 一、前端在整体里的位置

| 维度 | 约定 |
|------|------|
| **技术** | 全 Rust，用 **Yew** 编译成 **WASM**，在浏览器中运行。 |
| **服务对象** | 一个前端服务三端：游客、导游、仲裁员（通过路由或入口区分）。 |
| **两种模式** | 普通 Web（仅调 API）+ DApp（连接钱包，代币支付/质押、签链上交易）。 |
| **与业务关系** | 前端 + 后端完成「预约、订单、导游列表」；**确认订单后上链**，每笔旅行对应一个智能合约；**钱包在前端侧负责用代币支付该笔旅行费用**。表现层边界见 [02-架构设计](02-架构设计.md)；与后端 API 对接以 [04-后端与API](04-后端与API.md) 定稿为准。 |

---

## 二、业务流程在前端的体现（预约 → 确认 → 上链 → 钱包付代币）

```
游客端:
  浏览导游(API) → 选择导游、填行程、下单(API) → 确认订单
    → 上链：为该笔旅行创建/分配 Escrow 合约（含旅行费用、质押规则）
    → 钱包：用户用钱包支付「这笔旅行的费用」（代币打入该合约）
    → 行程中/完成后：确认完成 → 合约放款给导游；可评价

导游端:
  注册/质押(API + 钱包代币质押) → 接单(API) → 确认完成(钱包签名)
    → 收入由合约放款到导游钱包

仲裁端:
  查看争议(API) → 裁决(API) → 执行由合约完成（退款/扣罚）
```

| 数据与操作 | 前端落点 |
|------------|----------|
| 订单、导游、预约、争议内容 | 通过 **api** 模块与后端通信。 |
| 上链、支付旅行费用、质押 | 通过 **dapp** 模块连接钱包，前端发起签名。 |

**DApp 与 Web 业务数据同步（P0 口径）**：

| 维度 | 约定 |
|------|------|
| **业务数据** | 旅行行程、接待人员/导游信息、订单详情、档期、争议与证据 **唯一数据源 = 后端 API/DB**；Web 页与 DApp 页**共用同一套 API**（同一 `api/` 模块），不因是否连接钱包而分源或分缓存。 |
| **链上仅负责** | 支付、质押、确认完成等由钱包签名完成；业务展示以 API 为准，与 01/02「链为准、DB 为缓存与检索」一致。 |
| **实现要求** | 同一订单在 Web 与 DApp 页上的行程、接待人、订单状态须一致；DApp 路径不单独维护业务数据、不用本地状态覆盖 API 结果。 |
| **超时与争议窗口** | 接单/支付/完成超时、争议窗口（如 disputeDeadline≥autoCompleteAt）等时间节点以 01、[03-业务流程与风控](03-业务流程与风控.md) 定稿为准；前端从 API 获取并展示，不单独维护配置，与合约/后端可配置值保持一致（见 01 §5、01 §10 12 缝 #3）。 |

---

## 三、技术选型（Rust 前端）

**前端框架（已锁定）**：**Yew**（Rust → WASM），与 [01-总库总览](01-总库总览.md)、[02-架构设计](02-架构设计.md)、[07-开发流程与顺序](07-开发流程与顺序.md) 表现层约定一致；满足「一个前端、Web + DApp 两种模式、业务数据同源」，不采用多端统一框架。

| 项目 | 选型 | 说明 |
|------|------|------|
| 框架 | Yew | 组件化、Rust → WASM，单页应用 |
| 构建 | Trunk | WASM 编译、资源、dev server |
| 请求 | gloo-net | 发 HTTP 到后端 API |
| 状态 | Yew Context 或简单 state | 登录态、钱包连接态、当前订单等 |
| 路由 | yew-router | 区分游客/导游/仲裁页面与子页 |
| DApp/钱包 | 标准接口（注入 provider、WalletConnect 等），**兼容市场上所有钱包**；登录/签名可选 **SIWE**（01 §7 P1） | 连接用户已有钱包、签名、支付代币、调合约 |

---

## 四、前端仓库骨架（crates/web）

```
crates/web/
├── Cargo.toml
├── Trunk.toml
├── index.html
├── static/
└── src/
    ├── lib.rs
    ├── app.rs
    ├── pages/
    │   ├── auth/           # 注册、登录、忘记密码、重置密码（邮箱注册/登录）
    │   ├── me/              # 个人中心 / 账号设置：资料、修改密码、绑定钱包、我的订单/评价/统计
    │   ├── tourist/         # 首页、导游详情、下单、确认订单、订单列表、评价
    │   ├── guide/           # 仪表盘（接待单数、完成单数、总收入、评分）、质押、订单、资料
    │   └── arbitrator/      # 争议列表、裁决
    ├── components/         # layout、导游卡片、订单卡片、状态标签、连接钱包、支付/质押/争议签名入口（对应 §九 L4）
    ├── api/                # client、auth、me（profile/stats）、guides、orders、disputes
    └── dapp/               # wallet、escrow、staking、types
```

---

## 五、模块职责简表

| 模块 | 职责 |
|------|------|
| **lib.rs / app.rs** | 入口与根布局、全局路由；未登录可跳转注册/登录。 |
| **pages/auth/** | **注册**（邮箱+密码）、**登录**、忘记密码、重置密码。 |
| **pages/me/** | **个人中心 / 账号设置**：查看/编辑资料（昵称、头像）、修改密码、绑定/解绑钱包；**我的订单、我的评价**；按角色展示**统计**（游客：总消费；导游：接待战绩、总收入、评分）。 |
| **pages/tourist/** | 首页、导游详情、下单、确认订单、订单列表、评价。 |
| **pages/guide/** | **仪表盘**（接待单数、完成单数、**总收入**、平均评分）、质押、订单、资料。 |
| **pages/arbitrator/** | 争议列表、裁决。 |
| **components/** | 通用 UI；含「连接钱包」「用代币支付这笔旅行」等 DApp 组件。 |
| **api/** | 与后端 REST 的交互：**auth**（注册、登录、登出、刷新）、**me**（profile、stats、更新资料）、导游、订单、争议。 |
| **dapp/** | 钱包连接、签名、用代币支付旅行费用、质押、确认完成、**发起争议（openDispute）**等链上操作（与 01 §7 deposit/confirm/openDispute 须钱包签一致）。 |

---

## 六、账号与个人中心在前端的落点

| # | 模块/场景 | 约定 |
|---|-----------|------|
| 1 | **注册 / 登录** | `pages/auth/` 提供邮箱注册、登录；登录后写入 token/session，后续请求带认证头。 |
| 2 | **个人中心（我的）** | `pages/me/` 或导航「账号设置」：展示当前用户资料，可编辑昵称、头像、修改密码、**绑定/解绑钱包**；**我的订单**、**我的评价**；按角色展示**统计**（游客：订单数、总消费；导游：接待单数、完成单数、总收入、平均评分）。**钱包换绑与已支付订单（P0）**：与 [01-总库总览](01-总库总览.md) §7、§10 12 缝 #11 一致——已支付（Escrowed 及以后）订单与换绑硬规则：Paid 后换钱包=dispute 或新单；UI 与文档须写死，不允已支付订单随意换绑导致归属歧义。 |
| 3 | **导游仪表盘** | `pages/guide/` 仪表盘首屏：待接单数、进行中订单、已完成单数、总收入、平均评分；收入数据来自后端 `/api/v1/me` 或 `/api/v1/me/stats` 聚合（与链上放款对账）。 |

以上与 [04-后端与API](04-后端与API.md) 中的认证、`/api/v1/me`、统计口径一致。

---

## 七、关键流程在前端的落点（代币支付这笔旅行）

| # | 流程 | 约定 |
|---|------|------|
| 1 | **确认订单页（游客）** | 调用 API 确认订单；调用 dapp 弹出钱包，用户签名将**旅行费用（代币）**转入该笔 Escrow。组件示例：`pay_with_token.rs`，在 `order_confirm.rs` 使用。**UI 事实（P0）**：已支付仅来自链上 Paid/对账（见开篇一致性表）；支付 **pending** 时仅依据 API/链上状态展示，可展示 **confirmations**（区块确认数），与 [01-总库总览](01-总库总览.md) §7 一致。**用户连点/幂等**：确认、支付等操作须防重复提交（如按钮 disable、loading 态）；与后端幂等键（requestId/idempotency-key）配合，与 01 §10 17 条 #14（orderId+action）一致。 |
| 2 | **导游质押（导游）** | 在 `stake.rs` 用 dapp/staking：连接钱包 → 签质押交易。 |
| 3 | **导游确认完成（导游）** | 在 `orders.rs` 调 API 通知完成，必要时用 dapp/escrow 签「确认完成」让合约放款。 |
| 4 | **发起争议（游客/导游）** | 任一方在订单 Escrowed 状态下可发起争议；前端调 API（如 POST `/api/v1/orders/:id/dispute`）提交争议与证据，并通过 **dapp/escrow** 唤起钱包签 **openDispute**（须付仲裁费 arbFee，与 [01-总库总览](01-总库总览.md) §7 deposit/confirm/openDispute 须钱包签一致；02 链上·用户签）。 |
| 5 | **仲裁执行** | 前端只调 API 提交裁决或展示结果；执行由后端/合约完成。 |

---

## 八、与总库总览的关系

| 文档 | 关系 |
|------|------|
| [01-总库总览](01-总库总览.md) | 整仓 crates、DB 与链分工、业务流程与钱包策略；§7 DApp/钱包/EIP-712/代付 P0、§9 Web 与 DApp 业务数据同源 为本前端依据。 |
| [02-架构设计](02-架构设计.md) | 表现层 = crates/web；本文为上述流程在前端的落实（目录、页面、api/dapp 分工、钱包付代币落点、业务数据同源）。 |
| [03-业务流程与风控](03-业务流程与风控.md) | 超时/争议窗口与前端展示一致；业务规则定稿见 01/03；本文 §二、§九 9.0.3。 |
| [04-后端与API](04-后端与API.md) | 认证、/api/v1/me、统计口径、订单/导游/争议 API；业务数据以 04 为唯一来源，见 §六、§七。 |
| [06-DApp架构总览](06-DApp架构总览.md) | DApp 定位、钱包/签名/合约交互、业务数据与 Web 同源。 |
| [07-开发流程与顺序](07-开发流程与顺序.md) | Phase 4（前端与 DApp）、Phase 5 依赖本文；阶段衔接与开工前检查见 §十 9.4。 |

---

## 九、UI/UX 设计风格与页面层级规划

本节约定前端的**设计语言**（Web3 科技感与信任感）、**页面分层结构**（四层）、**各层内容**与 01～04 的对应，以及 **UI/UX 顶级要求与细节规范**（9.0.5：可访问性、响应式与触控、状态与反馈、排版、动效、表单、导航、安全与信任 UX、性能、DApp 专属、国际化），并与 [01-总库总览](01-总库总览.md)、[02-架构设计](02-架构设计.md)、[03-业务流程与风控](03-业务流程与风控.md)、[04-后端与API](04-后端与API.md) 中的功能与角色一一对应，便于实现时统一风格与信息架构。

### 9.0.1 设计语言与风格（Web3 科技感）

**定位对齐**：TrustLayer = 全球旅行 + **去中心化信任** + 安全预订 / 担保支付 / 可验证信誉（01 项目定位）。UI/UX 须同时传达**可信、透明、链上可验证**与**旅行、当地、人文**，避免纯极客或纯OTA 风格。

| 维度 | 约定 | 说明 |
|------|------|------|
| **主色调与氛围** | 深色/半透明为主，科技蓝·青·紫渐变点缀；高对比可读 | 深色背景（如 #0d1117～#161b22）降低眩光、突出链上状态与数据；主色（#3b82f6 / #06b6d4 / #8b5cf6）用于 CTA、链接、状态高亮；可选浅色模式（遵循系统或用户偏好） |
| **玻璃态与层次** | 卡片/面板使用 backdrop-blur、细边框、轻微阴影 | 区分「区块」与「背景」；链上状态块、钱包连接态、订单状态条可用玻璃态区分层级 |
| **数据与链上可视化** | 状态标签、进度、confirmations、tx 链接、金额与代币符号统一 | 订单状态与 01 §1、04 status 枚举一致（含 PartiallyRefunded、Slashed、Cancelled）；pending 展示 confirmations（01 §7 UI 事实）；金额+代币（如 USDC）与 04 API 一致 |
| **字体与排版** | 无衬线为主；数字与金额等宽或 tabular；层级清晰（标题/正文/辅助） | 保证可读性与多语言扩展；关键操作（支付、签名、发起争议）按钮与文案突出、二次确认 |
| **图标与符号** | 钱包、链、锁、盾、勾/叉、时钟、争议等语义化图标统一 | 与 01/02 概念一致：Escrow=托管、Staking=质押、Dispute=争议、Confirm=确认完成 |
| **动效与反馈** | 加载态、成功/失败 toasts、禁用/loading 防连点（01 §10 17 条 #14） | 链上交易：pending → confirmations → 成功/失败；与 04 接口错误、超时提示一致 |

**DApp 与 Web 统一**：同一套设计语言；DApp 路径仅增加「连接钱包」「签名确认」等组件，不改变整体风格（与 01 §9、02 §八 业务数据同源一致）。

### 9.0.2 页面层级（四层）与每层内容

页面在结构上分为**四层**：全局壳 → 区域布局 → 页面视图 → 组件/区块。实现时对应 `app.rs` 根布局、按角色/模块的布局组件、各 `pages/*` 页面、以及 `components/` 内可复用块。

| 层级 | 名称 | 职责 | 对应 01～04 功能/角色 |
|------|------|------|------------------------|
| **L1 全局壳（Shell）** | 顶栏/侧栏、品牌、全局导航、钱包与用户 | 品牌标识、角色入口（游客/导游/仲裁）、「连接钱包」、用户菜单（个人中心、登出）、通知/链状态提示 | 01 §2 用户与账号、§7 钱包；04 认证、/me；三端入口 |
| **L2 区域布局（Layout）** | 按角色或模块的二级导航与主内容区 | 游客：首页/导游/订单/我的；导游：仪表盘/订单/质押/资料；仲裁：争议列表/裁决；每区左侧或顶部分 Tab/导航 | 01 数据流表（游客/导游/仲裁员）；04 路由与权限 |
| **L3 页面视图（Page）** | 单页完整内容：列表、详情、表单 | 导游列表、导游详情、下单表单、订单详情、确认订单与支付、订单列表、个人中心、仪表盘、争议列表、争议详情与裁决表单等 | 01 业务流程、状态机；03 超时/争议；04 API 对应页面（guides、orders、me、disputes） |
| **L4 组件/区块（Component）** | 可复用 UI 块与 DApp 控件 | 导游卡片、订单卡片、状态标签、支付金额与代币、**连接钱包**、**支付/质押/确认完成/发起争议** 的签名入口、评价表单、证据上传、超时/争议窗口提示 | 01 §7 钱包签、UI 事实；02 表现层；04 接口字段与状态 |

### 9.0.3 关键页面与 01～04 功能对应表

下表列出主要**页面（L3）**及其承载的 01～04 功能，便于实现与审计时对照。

| 页面（L3） | 所属角色/模块 | 主要功能（01～04 对应） | 备注 |
|------------|----------------|-------------------------|------|
| **首页 / 导游列表** | 游客 | 浏览导游（01 预约、04 GET /api/v1/guides）；筛选 city/language/service_type | L2 游客区首页 |
| **导游详情** | 游客 | 导游信息、档期、下单入口（01 选择导游、04 GET /api/v1/guides/:id） | 进入下单流程 |
| **下单 / 确认订单** | 游客 | 填行程、下单（04 POST /api/v1/orders）；确认订单后**钱包付代币**（01 §7、02 链上·用户签；§七 pay_with_token） | 含金额、代币、超时提示（03）；UI 事实、连点幂等（01 §10） |
| **订单列表 / 订单详情** | 游客/导游 | 我的订单、状态展示（01 §1 状态机）、接单/取消/确认完成/发起争议（04 对应 API）；pending 展示 confirmations（01 §7） | 按角色过滤；导游侧接单、确认完成+钱包签 |
| **支付 / 质押 / 发起争议** | 游客/导游 | 钱包签 deposit、staking、openDispute（01 §7、02 §十三 13.1）；仲裁费提示（01 §5、03） | L4 组件嵌入订单页或独立弹窗 |
| **个人中心 / 账号设置** | 通用 | 资料、修改密码、绑定/解绑钱包（01 §2、§10 12 缝 #11）；我的订单、我的评价、统计（04 /api/v1/me） | §六；钱包换绑与已支付订单 P0 |
| **导游仪表盘** | 导游 | 待接单/进行中/已完成、总收入、评分（01 个人中心、04 /api/v1/me 统计） | §六；与链上放款对账口径一致 |
| **质押** | 导游 | 连接钱包、签质押（01 §4 Staking、04 POST guides/:id/stake） | §七 2 |
| **争议列表 / 争议详情 / 裁决** | 仲裁员 | 争议列表与详情（04 GET /api/v1/disputes）；裁决提交（04 POST resolve）；证据展示（01 §6） | 执行由后端/合约，前端只调 API（01 数据流表） |
| **注册 / 登录 / 忘记密码** | 通用 | 邮箱注册与登录（01 §2、04 auth 路由） | pages/auth |

### 9.0.4 与 01～04 的对照要点

| 文档 | 对照要点 | 05 落点 |
|------|----------|---------|
| **01** | 业务流程、状态机、钱包签（deposit/confirm/openDispute）、UI 事实、代付 P0、业务数据同源、12 缝 #11 钱包换绑 | §九 9.0.1 设计语言（状态/金额/代币）、9.0.2 L4 组件（钱包与签名）、个人中心与订单页 |
| **02** | 表现层 = crates/web、链上·用户签、§十三 13.1 前端/代付与资金边界 | L1/L4 钱包与签名入口、不代付不持私钥的文案与流程 |
| **03** | 超时/争议窗口与前端展示一致、争议人工裁决 | L3 订单页与争议页的超时与窗口提示、仲裁员裁决表单 |
| **04** | 认证、/api/v1/me、导游/订单/争议 API、幂等与错误提示 | 各 L3 页面与 04 路由、字段、状态枚举一致；错误与 loading 态统一 |

### 9.0.5 UI/UX 顶级要求与细节规范

以下为**企业级 UI/UX 顶级要求**，实现与验收时须满足；与 01 §7 UI 事实、§10 17 条 #14、03 超时/争议展示、04 接口与错误码一致。

#### 可访问性（Accessibility）

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **标准** | 至少符合 WCAG 2.1 Level AA（或当地等效）；关键流程（注册/登录、下单、支付、发起争议）须通过 a11y 自检 | 企业级产品、多地区用户 |
| **对比度** | 正文与背景对比度 ≥4.5:1，大号文字/图标 ≥3:1；状态色（成功/警告/错误）在深色与浅色背景下均满足 | 可读性、色盲友好 |
| **焦点与键盘** | 所有可交互元素可键盘聚焦；焦点顺序符合视觉与逻辑；焦点环可见（不依赖仅色差）；无键盘陷阱 | 键盘用户、辅助技术 |
| **焦点管理** | 弹窗/抽屉打开时焦点移入、关闭时还原；路由切换后焦点落于主内容或标题 | 屏幕阅读器、键盘 |
| **语义与 ARIA** | 按钮/链接/表单用原生语义；必要时 aria-label/aria-describedby/role 补足；列表、表头、状态用正确语义 | 屏幕阅读器 |
| **表单** | 每输入必有可见 label 或 aria-label；错误与必填提示与控件关联（aria-invalid、aria-errormessage）；必填项明确标注 | 04 接口校验与前端一致 |

#### 响应式与触控

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **视口** | 支持 320px～1920px 宽度；关键页面（列表、详情、下单、支付）在 375px 与 768px 断点可用、无横向滚动条遮挡内容 | 手机与平板优先、桌面兼容 |
| **触控目标** | 可点击/触控区域最小 44×44px（或 44pt）；相邻可点元素间距足够，避免误触 | 移动端、WCAG 2.5.5 |
| **输入方式** | 移动端优先使用合适输入类型（tel/email/number/date）；数字与金额考虑数字键盘 | 04 字段类型、体验 |

#### 状态与反馈

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **加载态** | 列表/详情：优先骨架屏（skeleton）而非仅转圈；按钮/提交：loading 态 + 禁用防连点（01 §10 17 条 #14） | 感知性能、防重复提交 |
| **空状态** | 列表无数据时展示明确空状态文案与 CTA（如「去选导游」「去接单」），不空白 | 引导与角色动线 |
| **错误态** | API/网络错误：用户可读文案 + 可重试或返回；与 04 错误码/文案一致；链上失败（如 reject、revert）：明确「交易未成功」、不误导为已支付 | 01 §7 UI 事实、04 错误约定 |
| **成功态** | 关键操作（支付、质押、发起争议、裁决提交）后明确成功反馈（toast/页内）；链上成功可附 tx 链接与 confirmations（01 §7） | 可验证、可追溯 |
| **超时与争议窗口** | 接单/支付/完成超时、争议截止时间从 API 获取并展示；倒计时或截止日期清晰；过期后按钮禁用并说明原因（与 03 一致） | 03、01 §10 12 缝 #3 |

#### 排版与视觉层次

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **层级** | 标题/正文/辅助至少三级；字号与字重区分；主操作（CTA）在视觉上优先 | 9.0.1 设计语言 |
| **数字与金额** | 金额、数量、区块号等用等宽或 tabular-nums；小数位与 04 API 一致（如 USDC 6 位）；千分位与本地化一致 | 01 状态/金额、04 字段 |
| **状态标签** | 订单/争议状态与 01 §1 状态机、04 status 枚举一致（Created, Accepted, Escrowed, Completed, Disputed, Refunded, PartiallyRefunded, Slashed, Cancelled 等）；颜色与文案统一；pending 时展示 confirmations 而非「已支付」 | 01 §7 UI 事实 P0、04 §二 2.2 orders |

#### 动效与动效偏好

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **时长** | 过渡动画一般 ≤300ms；页面级切换 ≤400ms；避免长于 500ms 的阻塞性动效 | 响应感、不拖沓 |
| **减少动效** | 尊重 `prefers-reduced-motion: reduce`：禁用或大幅减弱非必要动效，保留仅用于反馈的短时变化 | 无障碍、前庭敏感用户 |
| **用途** | 动效用于状态变化反馈、层级过渡，不用于纯装饰；加载、成功/失败 toasts 须清晰可辨 | 9.0.1 |

#### 表单与输入

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **校验时机** | 失焦或提交时校验；破坏性操作（解绑钱包、发起争议）前二次确认，文案写清后果 | 04 校验规则、01 12 缝 #11 |
| **错误展示** | 错误信息贴近控件、可读；不仅依赖颜色（辅以图标或文案） | 可访问性、04 错误码 |
| **敏感操作** | 支付、质押、openDispute、确认完成：弹窗内明确展示金额、代币、合约/订单标识，并提供「取消/拒绝」选项 | 01 §7 钱包签、防误操作 |

#### 导航与结构

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **当前页** | 导航高亮当前页面或 Tab；多步流程（下单→确认→支付）有步骤指示或面包屑 | L2 区域布局、流程清晰 |
| **返回与出口** | 弹窗/全屏流程可关闭（按钮或 Esc）；支付/签名流程用户可取消并返回 | 不强迫完成、可撤销 |
| **深度** | 关键任务（下单、支付、争议）点击深度尽量 ≤3；重要入口在 L1/L2 可见 | 01 业务流程 |

#### 安全与信任 UX

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **不可逆操作** | 解绑钱包、发起争议、仲裁裁决等：明确文案说明后果 + 二次确认；钱包换绑与已支付订单按 01 §10 12 缝 #11 硬规则（已支付后换绑=dispute 或新单，UI 禁止误导） | 01 §7、§10 12 缝 #11 |
| **不代付/不托管** | 文案与流程中不出现「平台代付」「托管您的私钥」等；支付/签名均表述为用户在钱包中操作 | 01 代付 P0、02 §十三 13.1 |
| **链上信息可见** | 签名前展示关键参数：金额、代币、订单/合约标识、网络；与 EIP-712 展示一致 | 01 §7、防钓鱼 |

#### 性能与鲁棒性体验

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **首屏与列表** | 首屏关键内容优先加载；长列表考虑分页或虚拟滚动，避免一次性渲染大量 DOM | 感知性能 |
| **请求超时** | API 或 RPC 超时时有明确提示与重试入口；不长时间白屏或转圈无反馈 | 04 超时、链 RPC |
| **离线与弱网** | 网络不可用时给出提示；恢复后可重试或刷新；不静默失败 | 旅行场景、移动网络 |

#### DApp 与钱包专属

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **连接钱包** | 入口清晰；支持主流钱包与 WalletConnect；连接失败时错误可读、可重试 | 01 §7、§三 技术选型 |
| **签名请求** | 每次签名前展示操作含义（支付/质押/确认完成/openDispute）、金额与代币、目标合约/订单；用户可拒绝 | 01 §7 钱包签、安全 UX |
| **链与网络** | 当前链/网络标识可见；切换网络时状态与提示明确 | 多链或测试网场景 |

#### 国际化与扩展

| 要求 | 细节 | 依据/说明 |
|------|------|-----------|
| **文案** | 所有用户可见文案可配置为多语言；数字、日期、金额格式支持本地化 | 01 全球旅行定位 |
| **RTL** | 若支持 RTL 语言，布局与焦点顺序支持 RTL（可选，MVP 后可迭代） | 扩展性 |

---

**验收与维护**：上述要求作为前端实现与设计评审的**必选基线**；具体数值（如断点、色值、间距 token）可在设计系统或 `static/` 中细化，与 01/03/04 业务与接口约定保持一致。变更 01 状态枚举、04 错误码或 03 超时规则时，须同步更新本节相关表述。以上 §九 为**顶级设计与规划**及**UI/UX 顶级要求**层面约定；具体视觉规范（色值、间距、组件库）可在设计稿或 `static/` 设计 token 中细化，与本文保持一致即可。

---

## 十、企业级审计标注

本节提供与 01/02/03/04/06/07 可追溯性、前端职责边界、数据流与 API 依赖、安全与权限、文档控制的企业级审计维度、核对要点、审计报告、开工前检查清单及使用说明；与 [01-总库总览](01-总库总览.md) §10 审计前检查清单及 [07-开发流程与顺序](07-开发流程与顺序.md) 阶段衔接。子节编号 **9.1～9.5** 为 §十 审计标注专用，与 §九 子节 9.0.x 区分。

### 9.1 审计维度

| 维度 | 说明 | 依据 |
|------|------|------|
| **与 01/02/03/04 一致性** | 01 §7/§9/§10 12 缝 #11、02 表现层、03 超时/争议窗口展示、04 认证/me/API 在 05 的落点 | 开篇「05 与 01/02 关键一致性核对」表（8 项）、总览主题符合性表 |
| **前端职责边界** | 仅表现层：API 调用、钱包签名、不代付、不持私钥、业务数据唯一来自 API | §二、§五、§七 |
| **数据流与 API 依赖** | Web 与 DApp 共用 api/ 模块；订单/导游/争议/档期以 04 API 为准 | §二、§五、§六 |
| **安全与权限** | 登录态、钱包连接态；不代签、不托管；EIP-712/UI 事实以 01 为准 | 01 §7、§二、§七 |
| **可追溯性** | 01/02/03/04/06/07 中凡引用 05 处，本文均有对应节或表项 | 开篇、§二、§六、§八、§九、§十 9.2 |
| **文档控制** | 受众、维护责任、版本见 00、变更同步 01/02/03/04（涉及 DApp 时同步 06） | 开篇受众与用法、维护责任 |

### 9.2 核对要点

| 文档/维度 | 核对内容 | 05 落点 |
|-----------|----------|---------|
| **01 引用 05** | §2 注册/登录、个人中心；§7 DApp/钱包/EIP-712/代付 P0、UI 事实；§8 总库 web；§9 业务数据同源；01 表「游客/导游/仲裁员」 | §四 pages/auth、§六 pages/me；§二、§七；§四 crates/web；§二 唯一数据源=API、共用 api/；前端三端 pages/tourist、guide、arbitrator 与 01 一致 |
| **02 引用 05** | 表现层 = crates/web、DApp 模式/钱包与签名、Web 与 DApp 业务数据同源（§八、01 §9、05/06） | 开篇、§二、§四、§八 |
| **03 与 05** | 超时/争议窗口展示与 01/03 一致，数据来自 API；05 不单独维护业务规则 | §二 超时与争议窗口由前端从 API 获取并展示、与 01/03 定稿一致 |
| **04 引用 05** | 业务数据同源、认证/me/统计口径 | §六、§七、开篇「与 01/02/04 对应」 |
| **01 §10 17 条/12 缝与前端** | 17 条 #2（Paid 仅来自 deposit）、#11 缝（钱包解绑/换绑与已支付订单）、#14（连点幂等） | 开篇一致性表、§二、§六、§七；§六 钱包换绑与已支付订单 |
| **02 §十三 架构级检查清单** | 13.1 前端/代付、资金边界 | 05 开篇表「DApp/代付 P0」「UI 事实 P0」、§二、§七 |
| **06 与 05** | 06 与 05 配合阅读、业务数据同源与 DApp 职责边界 | 05 开篇、§二、§八 已列 06；06 引用 05 处在 05 均有对应 |
| **07 与 05** | Phase 4/5 依赖 05、阶段衔接 | 05 受众与用法、9.4 开工前检查清单、§八 表已列 07 |

### 9.3 企业级审计报告（本轮）

以下为逐项审计结果汇总；审计维度与核对要点见 9.1、9.2。

| 项目 | 内容 |
|------|------|
| **审计范围** | 05 全文与 01/02/03/04/06/07 的可追溯性、开篇**前端文档用法**、一致性表 **8 项**、总览主题符合性表 **6 行**、**§九 UI/UX** 与 01～04 对应、前端职责边界、数据流与 API 依赖、**01 §10 17 条/12 缝**前端落点、**02 §十三 13.1** 与 05 对应、文档控制（含 06 同步）、引用链接；§十 9.3 含历史审计摘要、**第五轮（瘦身与缺口检查）**、**第六轮（顶级标准）** |
| **审计依据** | 01 总库总览（§2、§7、§8、§9、**§10 12 缝/17 条**）、02 架构设计（表现层、§八、**§十三 13.1**）、03 业务流程与风控（超时/争议窗口）、04 后端与 API（认证、me、业务数据同源）、00 文档索引 |

**逐项审计结果**：

| 审计项 | 审计方法 | 结果 | 备注 |
|--------|----------|------|------|
| 01 引用 05 可追溯 | 01 中「见 05」「04/05」→ 05 对应节（auth、me、业务数据同源、用户与账号） | ✅ 通过 | §四、§六、§二、§八 |
| 02 引用 05 可追溯 | 02 表现层、业务数据同源、05 链接 → 05 开篇、§二、§四、§八 | ✅ 通过 | 开篇、§八 表 |
| 04 引用 05 可追溯 | 04 业务数据同源、认证/me → 05 §二、§六、§七 | ✅ 通过 | 开篇补 04 对应、§六、§七 |
| 03 引用 05 可追溯 | 03 文末链接 05、「与前端展示一致」→ 05 §二 超时/争议窗口、9.2 | ✅ 通过 | §二、9.2 |
| 06 引用 05 可追溯 | 06 与 05 配合阅读、业务数据同步、前端模块与 dapp 目录 → 05 开篇、§二、§四、§八 | ✅ 通过 | 开篇、§八 表、9.2 |
| 07 引用 05 可追溯 | 07 Phase 4/5 依赖 05、参考文档列 05 → 05 §八、9.2、9.4 | ✅ 通过 | §八 表、9.2、9.4 |
| 05 与 01 关键一致性 | 开篇「05 与 01/02 关键一致性核对」**8 项**与 01 定稿逐项对照 | ✅ 通过 | 8 项结论均为「一致」 |
| 05 与 01 总览主题符合性 | 开篇「05 与 01 总览主题符合性」表 **6 行**与 01 总览主题对照 | ✅ 通过 | 无冲突 |
| 前端职责边界 | 不代付、不持私钥、业务数据唯一来自 API、钱包签由用户发起 | ✅ 通过 | §二、§七 |
| 文档控制 | 受众、维护责任、版本见 00、变更同步 01/02/03/04 已载明 | ✅ 通过 | 开篇受众与用法（含 03） |
| 引用链接 | 01/02/03/04/06/07/00 链接有效、无断链 | ✅ 通过 | 文内与文末 |
| 01 §10 17 条/12 缝前端落点 | 17 条 #2/#11 缝/#14、12 缝 #11 在 05 有明确落点（开篇表、§二、§六、§七、9.2） | ✅ 通过 | 开篇一致性表 8 项、§六 钱包换绑、§二 超时/争议窗口、9.2 |
| 02 §十三 13.1 与 05 对应 | 13.1 前端/代付、资金边界 → 05 开篇一致性表、§二、§七 | ✅ 通过 | 9.2 已补；与 01 代付 P0、UI 事实 P0 一致 |
| 03 与 05 正文落点 | 03「与前端展示一致」→ 05 §二 超时/争议窗口、9.2 | ✅ 通过 | §二 已补「超时与争议窗口」段 |
| §九 UI/UX 与 01～04 对应 | §九 9.0.1～9.0.5 设计语言、四层结构、关键页面表、UI/UX 顶级要求与 01～04 功能/角色一致 | ✅ 通过 | §九 9.0.3 关键页面表、9.0.4 对照要点、9.0.5 细节规范 |

**历史处置摘要**：开篇两表、03/04/06/07 对应、§七 UI 事实与连点幂等、§八 03/07 行、§九/§十、openDispute/SIWE、01/04 维护责任补 05 等已在前序审计轮次闭合；历史审计摘要见上文、文档维护见 [00-文档索引](00-文档索引.md) 与 [01-总库总览](01-总库总览.md) 维护责任。

**审计结论**：**通过**。05 满足企业级可追溯性、与 01/02/03/04 一致性、前端职责边界、数据流与 API 依赖、文档控制及引用链接要求；可作为前端与 DApp 实现及与 04 接口对接依据。页面/模块或 API 调用变更后须与 04 一致并同步 01/02/03（涉及 DApp 时同步 06）、更新开篇表及本报告。

**历史审计摘要（第二～四轮）**：第二轮补 03 对应、8 项表述、§七 pending/confirmations 与连点幂等、§八 07；第三轮补 9.1/9.3 中 03、9.2 中 06 与 05、01 维护责任含 05、openDispute/SIWE/建议先读 03；第四轮对照 01-04 全文缺口复查，01/02/03/04 引用 05 均有落点、04 维护责任已补 05。各轮结论均为**通过**。

---

#### 第五轮企业级审计（瘦身与缺口检查）

在**文档瘦身**（合并第二～四轮审计为历史摘要、开篇增加**前端文档用法**）后，对 05 做缺口检查与企业级审计。

**瘦身操作**：① 开篇增加「**前端文档用法**」（05 为主、06 配合 DApp、无其他前端配套文档）。② 9.3 将第二～四轮详细缺口表与逐项复核合并为一段「历史审计摘要（第二～四轮）」；保留首轮审计范围/依据/逐项结果表及结论、历史处置摘要。③ 06 开篇增加「**DApp 文档用法**」。

**缺口检查**：01/02/03/04/06/07 引用 05 处未删减；开篇两表、§二～§九、§八 文档关系表、9.2 核对要点、9.4 检查清单均保留；无新缺口。**与 01～04 一致性**：开篇 8 项+6 行、§二 业务数据与超时/争议窗口、§六 钱包换绑、§七 5 条流程、§九 9.0.1～9.0.5 未改动，可追溯性完整。

**第五轮结论**：**通过**。瘦身未引入缺口；05 与 01～07 可追溯性、文档控制、前端用法说明完整；企业级审计要求持续满足。

---

#### 第六轮企业级审计（顶级标准）

按**顶级标准**对 05 做企业级审计：以 01/02/03/04/06/07 全文为依据，逐项核查可追溯性、一致性、文档控制、缺口与优化点。

**审计依据**：01 总库总览（§1 状态机、§2 用户与账号、§7 DApp/钱包/UI 事实/代付、§8 骨架、§9 同源、§10 12 缝/17 条）、02 架构设计（表现层、§八 同源、§十三 13.1）、03 超时/争议窗口与前端展示一致、04 后端与 API（认证/me/订单状态枚举/业务数据同源）、06 DApp 与 05 配合、07 Phase 4/5 依赖 05、00 文档索引。

**缺口与问题检查**：

| # | 检查项 | 结果 | 说明 |
|---|--------|------|------|
| 1 | 01 引用 05 的每条在 05 有落点 | ✅ 无缺口 | 注册/登录、个人中心、业务数据同源、总库/骨架、§7 钱包/UI 事实/不得仅因前端成功、数据流表、细节见 05 → §四、§六、§二、§八、开篇表、§七、§三 SIWE |
| 2 | 02/03/04/06/07 引用 05 的每条在 05 有落点 | ✅ 无缺口 | 02 表现层/同源/§十三；03 超时与前端展示一致；04 同源/认证/me/Phase 3 前端三端；06 配合阅读/业务数据/前端模块与 dapp；07 Phase 4/5、参考文档 05 → 05 均有对应节或表 |
| 3 | 01 §10 17 条中与前端/UI 相关条在 05 有落点 | ✅ 无缺口 | #2 Paid 仅来自 deposit → 开篇表 UI 事实、§七；#14 用户连点 orderId+action → §七 幂等、9.2；12 缝 #11 钱包换绑 → §六、开篇表 |
| 4 | 01 状态机/04 status 枚举在 05 的表述完整性 | ✅ 已补 | 9.0.1 数据与链上可视化、9.0.5 状态标签已注明与 04 枚举一致（含 PartiallyRefunded、Slashed、Cancelled） |
| 5 | 05 文档维护责任是否含 06 | ✅ 已补 | 开篇维护责任已加「涉及 DApp 展示或 api/dapp 分工时同步 06」；9.1 文档控制已加「涉及 DApp 时同步 06」 |
| 6 | 05 内部一致性 | ✅ 一致 | 开篇、9.1、9.2、9.4、§八 对 01/02/03/04/06/07 的表述与引用无冲突；子节 9.0.x 与 9.1～9.5 编号区分明确 |
| 7 | 引用链接有效 | ✅ 有效 | 01/02/03/04/06/07/00 文内与文末链接均有效 |

**逐项审计结果**（与首轮表一致，补充第六轮专项）：01/02/03/04/06/07 引用 05 可追溯、05 与 01 关键一致性 8 项、总览主题符合性 6 行、前端职责边界、文档控制（含 06 同步）、01 §10 17 条/12 缝前端落点、02 §十三 13.1、§九 UI/UX 与 01～04 对应、状态枚举与 04 一致——**均通过**。

**发现与处置**：① **状态枚举完整性**：9.0.1 与 9.0.5 已补与 04 status 枚举一致及 PartiallyRefunded、Slashed、Cancelled。② **维护责任含 06**：开篇与 9.1 已补涉及 DApp 时同步 06。

**第六轮结论**：**通过**。05 满足顶级标准下企业级可追溯性、与 01～04 一致性、01 §10 17 条/12 缝前端落点、文档控制（含 06）、状态枚举与 04 一致；无未闭合缺口，审计要求持续满足。

### 9.4 开工前检查清单（企业级）

与 [01-总库总览](01-总库总览.md) §10 审计前检查清单及 [07-开发流程与顺序](07-开发流程与顺序.md) 阶段衔接；前端开工或与 04 接口定稿前各做一次勾选。

| # | 检查项 | 要求 |
|---|--------|------|
| 1 | 01/02/03/04/06/07 引用 05 覆盖 | 开篇「与 01/02/04 对应」、**前端文档用法**（05 为主、06 配合 DApp）、03/06/07、一致性表 **8 项**、总览主题符合性表 **6 行**及 §二～§九 均已覆盖；01 §10 17 条/12 缝前端落点见 §十 9.2、§二、§六 |
| 2 | 05 与 01/02 一致性 | 开篇「05 与 01/02 关键一致性核对」**8 项**无冲突；总览主题符合性表 **6 行**与 01 一致；02 §十三 13.1 与 05 对应见 §十 9.2 |
| 3 | §九 UI/UX 与 01～04 对应 | §九 设计语言（9.0.1）、四层结构（9.0.2）、关键页面表（9.0.3）、**9.0.5 UI/UX 顶级要求与细节规范**与 01～04 功能/角色一致；L1～L4 与 pages/components 对应 |
| 4 | 与 04 接口一致 | 认证、/api/v1/me、订单/导游/争议/档期 API 与 04 定稿一致；业务数据不单独维护、不因连接钱包分源 |
| 5 | 规则变更同步 | 05 修改后已同步 01/02/03/04 相关节（涉及 DApp 时同步 06），并更新开篇两表及 9.3（若 01/02/03/04 条号或引用变更） |

### 9.5 使用说明

- **审计前**：按 §十 9.1 逐项勾选，核对开篇一致性表与总览主题符合性表与 01 定稿；9.3 可作审计记录（含历史摘要与最新轮次）；**9.4 开工前检查清单**前端开工与 04 接口定稿前各勾选一次（含 §九 UI/UX 与 L1～L4 对齐、开篇**前端文档用法**）。
- **规则变更**：修改 05 后须与 04 接口保持一致，并同步 01/02 及 03（超时/争议窗口等与前端展示相关）；涉及 DApp 展示或 api/dapp 分工时同步 06。更新开篇两表及 9.3 审计报告（若 01/02/03/04 条号或引用变更）。
- **版本**：文档版本与最后更新见 [00-文档索引](00-文档索引.md)。

---

*本文与 [01-总库总览](01-总库总览.md)、[02-架构设计](02-架构设计.md)、[03-业务流程与风控](03-业务流程与风控.md)、[04-后端与API](04-后端与API.md)、[06-DApp架构总览](06-DApp架构总览.md)、[07-开发流程与顺序](07-开发流程与顺序.md) 配套。文档版本与最后更新见 [00-文档索引](00-文档索引.md)。*
