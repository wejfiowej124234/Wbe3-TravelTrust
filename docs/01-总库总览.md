# TravelTrust 总库总览框架

**总库** = 全仓库；**总览** = 谁负责什么、数据/钱怎么流、关键硬约束。流程 → 骨架 → 链与 DB → 硬约束表。

**项目定位**：本仓库面向 **TrustLayer**——面向全球旅行服务的**去中心化协议**，为全球当地导游提供**安全预订**、**基于担保的支付（Escrow）**和**可验证的信誉**。**协议定位为去中心化**：资金与关键状态链上可验证、规则可审计、治理多签+TimeLock；运营层（仲裁/执行器/Registry）当前为多签治理，路线图含开放仲裁与治理可演进（见 [08-战略与合规风险检查清单](08-1-战略与合规风险检查清单.md) §N 与最终层面）。注册用户可成为**游客**或**导游**（双角色）；导游需**质押**并审核通过后获得导游身份，方可接单。技术架构为**混合形态**（链上资金与信任 + 链下业务与检索），链为准、DB 为缓存与检索，详见下文。

**文档用途**：实现与审计前必读；P0 条款为硬约束，须全部定稿后再开工。**阅读路径**：业务流程 → 用户与账号 → 混合架构与链 vs DB → 链与代币定稿 → Escrow/金额/争议 → 数据库与证据 → DApp 与权限 → 仓库骨架与数据流 → 小结/12 缝/17 条/系统级不变量。**细节文档**：02=架构设计，03=业务流程与风控，04=后端与 API，05=前端总览，06=DApp 架构总览，07=开发流程与顺序，08=战略与合规风险检查清单。

**受众与用法**：实现、架构、产品、风控、审计；P0/12 缝/17 条定稿前必读；细节与落点见 02/03/04/05/06/07。**文档维护责任**：产品或技术负责人；01 P0/12 缝/17 条/系统级不变量变更须同步 02/03/04 及 05 相关节（前端/DApp 展示相关）；§9/§10 或阶段与开发顺序相关时建议同步 [07-开发流程与顺序](07-开发流程与顺序.md)，涉及 DApp 时同步 [06-DApp架构总览](06-DApp架构总览.md)。文档版本与最后更新见 [00-文档索引](00-文档索引.md)。

**内容与结构（本文目录）**：1 业务流程 · 2 用户与账号 · 3 数据形态 · 4 智能合约 · 5 链与代币选型（一~十一）· 6 数据库 · 7 DApp 与权限 · 8 仓库骨架 · 9 数据流与职责 · 10 小结（12 缝 / 17 条 / 系统级不变量）。

---

## 1. 业务流程（预约 → 确认 → 上链 → 钱包付代币）

双方确认后**才上链**；EscrowFactory + 每单 clone，订单↔escrow 以**链上事件**为准、DB 为缓存。钱包付代币进托管=支付；行程结束双签确认→放款，争议→人工裁决后合约执行。缺口/评分/防恶见 [03](03-业务流程与风控.md)。

### 订单状态机（总览，硬约束口径）

订单状态枚举与合法迁移、**资金终态**、超时口径必须在总览层可见，避免实现优先级被误解。

| 状态 | 说明 | 合法下一状态 |
|------|------|--------------|
| **Created** | 游客已下单，待导游接单 | Accepted, **Cancelled**（接单超时或游客取消） |
| **Accepted** | 导游已接单，待游客支付进 escrow | **Escrowed**, **Cancelled**（支付超时或任一方取消） |
| **Escrowed** | 代币已打入托管，行程进行中 | **Completed**, **Disputed**（任一方发起争议） |
| **Completed** | 已放款给导游（链上 Released），可评价 | —（**终态**） |
| **Disputed** | 争议中，待仲裁与链上执行 | 见下（裁决后进入资金终态，**不统一叫 Completed**） |
| **Refunded** | 全额退款给游客（裁决后链上执行完毕） | —（**终态**） |
| **PartiallyRefunded** | 部分退款（游客拿一部分、导游拿一部分，常见） | —（**终态**） |
| **Slashed** | 扣罚已执行（导游被扣、游客可能部分退），裁决执行完毕 | —（**终态**） |
| **Cancelled** | 已取消/超时取消，未进 escrow | —（**终态**） |

**Disputed 的出路（硬约束）**：裁决后链上执行完成，订单必须落入**资金终态**之一，不得笼统写「Completed」：  
- 全额退游客 → **Refunded**  
- 部分退、部分给导游 → **PartiallyRefunded**  
- 扣罚导游（及可选部分退游客）→ **Slashed**  
- 裁决维持放款（争议驳回）→ **Completed**

**超时**（时长见 [03](03-业务流程与风控.md)）：接单超时（Created→Cancelled）；支付超时（Accepted→Cancelled）。**状态机与副作用联动（P0）**：**每个状态迁移触发的副作用**写死（占档、解档、发通知、开放评价、关闭 dispute、冻结）；**状态回放时副作用不重复/错发**（补偿或幂等）须在 [03](03-业务流程与风控.md)/[04](04-后端与API.md) 定稿。**完成确认（P0）**：双签+单方超时生效——导游 confirm 后游客 K 天内不 dispute 不 confirm→自动 Completed；dispute 则冻结。完成超时与自动放款一致。

---

## 2. 用户与账号体系（总览）

| 能力 | 说明 |
|------|------|
| 注册/登录 | 邮箱注册、邮箱+密码登录、JWT/session；见 [04](04-后端与API.md) 认证、[05](05-前端总览.md) 注册/登录页。 |
| 账号设置 | 资料、密码、绑定/解绑钱包；`/api/v1/me`。**身份与订单所有者（P0-1）**：**推荐**订单所有者=**下单时签名的钱包地址**；邮箱仅登录与通知；换钱包**仅允许新订单**，旧订单签名钱包不可变更；被盗应急=冻结接单/提现，**不改既有订单签名人**。一邮箱多钱包时谁签、防换马甲写死。 |
| 个人中心 | 游客：订单、消费、评价；导游：接待单数、完成单数、**总收入**（链上）、评分；仲裁员：裁决记录。见 [04](04-后端与API.md)/[05](05-前端总览.md)。 |

---

## 3. 数据形态结论：混合形态（协议为去中心化）

| 形态 | 用途 | 说明 |
|------|------|------|
| **链上（区块链）** | 资金托管、质押、信誉存证、仲裁结果存证 | 需要**智能合约**；保证不可篡改、可验证、去信任执行。 |
| **关系型 / 分布式数据库** | 用户资料、导游列表、订单详情、争议证据、检索与运营 | **不需要**智能合约；高并发、多地域、复杂查询用 DB；可用 PostgreSQL 或分布式 DB（CockroachDB、TiDB、YugabyteDB 等）。 |

**结论**：链上做信任与资金，DB 做业务与检索；方案 B：链下 KYC→Registry 发资格。**应对**：双写→链为准+对账+幂等；执行失败→队列+重试；RPC→多 endpoint+退避；合约→审计+最小权限；签名→EIP-712+白名单。**骨架**：UI(Yew) → Axum(DB+合约) + RPC + 钱包；持久化=PostgreSQL 或 CockroachDB/TiDB；合约=EVM。

### 链 vs DB 的 source of truth（P0）

| 链为准 | DB 为准 |
|--------|--------|
| Paid / Released / Refunded / Slashed、订单↔escrow 映射 | 行程、证据、评价、用户/导游、KYC、档期 |
| 以链上事件/对账同步 DB，幂等写；**不得仅因代付/前端成功置已支付** | 检索、列表、仲裁证据从 DB |

**链下→链上（P0）**：Paid/Completed/Refunded 等仅由链上事件（finalityN）驱动；人工修复只写 correction。锚点：EscrowCreated/Paid/DisputeOpened/ResolutionExecuted。Created/Accepted 须 EIP-712 签。**签名留痕/条款/平台身份**写死。**reorg**：event 表 blockHash+blockNumber+logIndex；checkpoint (blockNumber,logIndex)；投影可重建、CI 对比。**幂等与键（P0）**：API/队列/执行器/连点各有幂等键；orderId=bytes32；orderId 绑定 chainId。见 [02](02-架构设计.md)/[03](03-业务流程与风控.md)。

---

## 4. 哪些需要智能合约（链上）

| 模块 | 链上做什么 |
|------|------------|
| **Escrow** | Factory+每单 clone/槽位；锁代币、确认放款、争议按裁决退/扣；订单↔escrow 以事件为准。 |
| **Staking** | 导游/仲裁员质押、扣罚、解押。 |
| **Registry（方案 B）** | 审核通过写 approved（可撤销、过期）；等级可扩展。 |
| **Reputation** | 建议：评分哈希上链；详情在 DB。 |
| **Dispute 执行** | 可选：裁决后合约执行扣罚/退款。 |

**MVP**：EscrowFactory + 实例 + Staking + Registry（方案 B）；Reputation/Dispute 执行可 Phase 2。**Sybil 与评价（P0 硬口径）**：**仅资金终态订单可评价**；同一钱包对同一导游 **30 天内最多 N 次**（写死）；**被封号→历史评价保留但标记**；**reviewHash=keccak256(canonicalJson)**，**字段顺序写死**。

### 导游准入：方案 B（已采用）

链上 Staking 锁币 + 链下 KYC/资质审核 + 链上 Registry 发资格。**可升级为 VC**（Issuer 发 VC→后端验证→Registry，见 DID/VC）。币**必须在 Staking 合约**，不得热钱包/DB 记账。

| 层级 | 约定 |
|------|------|
| 链下审核 | KYC/资质/投诉在链下；原件存 DB，链上不存 PII。导游证或其它证件证明其具备接待能力，与 DID 一起**符合行业标准即可**（见 DID/VC 节）。 |
| 链上 Registry | 多签/运营调用 approve(guide, tier, expiry)；可撤销、可过期。 |
| 链上 Staking | 质押/扣罚/解押独立；**申请导游权限须满足质押门槛**（如 minStake(tier) 对应 10000U 档）；不足不能接单或仅低等级。 |
| 安全与冻结 | **Staking 冻结 P0** 写死：争议中可冻结 stake；撤销资格**不影响已 Escrowed 订单**；**解押冷却期 7–30 天**；**冻结期间不可 withdraw**。**撤销后存量订单（P0）**：撤销只影响新接单；已 Escrowed 走冻结/争议流程；必要时执行器介入。见 [03](03-业务流程与风控.md)/运营。 |

**可接单（P0）**：`registry.approved && now<expiry && staking>=minStake(tier) && !suspended`。

**服务品质约束（P0 口径）**：除准入质押外，**每单接单时可要求按订单金额一定比例的押金**（可从 Staking 锁定或单独押金池，具体比例与实现由产品/合约定稿）。**订单终态后**：**无差评**则该单押金退回；**有差评**则按规则**扣除押金并减信用分**，与现有 slash/信誉、评价权重联动，共同约束服务品质与质量。扣款比例、信用分公式与申诉见 [03](03-业务流程与风控.md) §二。

### DID/VC（P1）

**DID 与证件**：符合行业标准即可（如 did:pkh/did:key 等常用方案）；导游证或其它能力证明用于链下审核与 Registry 准入。导游资质链下 VC→后端验证→Registry.approve。MVP：did:pkh/did:key；续期/吊销、Issuer allowlist 写死；allowlist 变更多签+timelock+审计。**写死**：DID/VC 仅准入与续期，**不进入 Escrow/支付路径**。**反刷/限流（P0）**：下单/接单/争议/证据 rate limit、黑名单与冻结阈值写死。**证据 DoS（P0）**：大小上限、类型白名单、分块、病毒扫描、窗口内未完成处理写死。P1 占位：沟通/安全/费用税务见 [04](04-后端与API.md)/法务。

### 合约升级与权限边界（08 落点）

**企业级审计必问**：是否存在「终极控制路径」、Proxy 能否换 Implementation、是否存在 admin key、Timelock 是否可被绕过、是否存在超级管理员或紧急 override。本段为 [08-4 对外口径包](08-4-对外口径包.md) 与 [Runbook §7](../ops/RUNBOOK.md) **Immutable Core / 多签权限矩阵** 的落点；定稿时须与合约实现一致。合约设计承诺与实现状态见 [contracts/README](../contracts/README.md)。

| 项 | 约定（定稿时写死） | 落点 |
|----|---------------------|------|
| **Immutable Core vs Shell** | 核心资金逻辑（Escrow 释放条件、裁决执行逻辑）是否不可升级；若为可升级 Proxy，Shell 可升级范围写死 | 08-4 第 2 章、Runbook §7 |
| **Proxy / Implementation** | Proxy 是否能更换 Implementation；若能，谁可执行、是否 Timelock、多签门限 | 02 合约设计、08-4、Runbook 多签权限矩阵 |
| **admin key** | 是否存在单一 admin key；若存在，用途与收回/多签化路径写死 | 08-4、Runbook §7 |
| **Timelock** | 参数或升级是否经 Timelock；Timelock 是否可被绕过（如紧急多签豁免）及条件写死 | 08-3、Runbook §7 紧急可验证触发条件 |
| **紧急 override** | 是否存在紧急 override；若有，触发条件与边界写死于 Runbook §7 | Runbook §7、08-4 |

**多签可改**：运营/安全参数（Pause 白名单、allowlist、冷却期、证据保留期等，见 08-3）。**多签不可改**（或仅 Shell 可升级）：资金释放终态逻辑、单笔资金流向。具体以 08-4 多签权限矩阵与 Runbook §7 一页表为准。

---

## 5. 链与代币选型（P0 完整口径 · 定稿版）

*（与 §4 哪些需要智能合约衔接；链上资金与代币规则定稿。）*

**一、EVM 链选择（单链 MVP）**

**✅ 首选：Polygon PoS**

选择理由（与本仓库结构强匹配）：

| 维度 | 结论 |
|------|------|
| Gas 成本 | 低，适合「每单 clone Escrow」模型 |
| EVM 兼容 | 完整支持 Solidity / EIP-712 / EIP-1167 |
| 钱包支持 | 主流钱包默认支持 |
| RPC 生态 | 多供应商，可做容灾与退避 |
| 成熟度 | 主网稳定运行多年 |

**P0 写死**：chainId 固定（如 137）；orderId 强绑定 chainId（不得跨链迁移）；resolutionId = keccak256(chainId, orderId, resolutionSeq, decisionHash)（与 17 条一致）；单链 MVP，不做跨链桥、不做多链 escrow。

**⚖ Phase 2 备选：Arbitrum One** — 继承以太坊安全性、Gas 较低；L2 finality 与 reorg 规则不同、提现挑战期、事件确认逻辑需单独设计。不进入 MVP 范围，仅保留扩展接口。

**❌ MVP 不选：Ethereum** — Gas 不可控、每单部署成本高、不适合高频小额旅游订单。

**二、结算代币定稿（P0）**

**✅ 结算代币：USD Coin（USDC）**

**P0 写死规则**：Escrow 仅支持 USDC（ERC20）；支付必须为 transferFrom → EscrowInstance；DB 不得以「前端成功」标记 Paid；仅 Paid 链上事件可驱动 Escrowed 状态。

**为什么不用平台币（MVP 阶段）**：

| 风险 | 说明 |
|------|------|
| 合规 | 发行代币涉及证券风险 |
| 波动 | 旅行交易不应承受价格风险 |
| 流动性 | 新币难以保证市场深度 |
| 复杂度 | 设计 staking/utility 需要额外经济模型 |

平台币仅可用于 Phase 2 staking 激励，不作为支付货币。Staking 可 USDC 或平台代币（Phase 2）；不发行平台币（MVP）。

**三、Escrow 资金路径（链级硬约束）**

```
Tourist Wallet
   ↓ approve(USDC)
   ↓ transferFrom
EscrowInstance
   ↓ (Released / Refunded / PartiallyRefunded / Slashed)
Guide Wallet / Tourist Wallet
```

**资金系统级不变量（P0）**：Escrow 合约余额 ≥ 未终态订单金额；每个 orderId 仅允许一次资金终态执行；不存在「部分执行后可回滚」路径。资金终态只能由：双签确认、超时自动放款、裁决执行 三者之一触发。

**Escrow 架构（定稿）**：`EscrowFactory → clone (EIP-1167) → EscrowInstance(orderId, tourist, guide, amount)`。每个订单 1 个 EscrowInstance；orderId: bytes32；仅 Factory 可创建；资金终态只能执行一次（防重入+状态锁）。

**四、链上事件（审计锚点 · P0）**

| 事件 | 用途 |
|------|------|
| EscrowCreated(orderId, escrow) | 订单↔合约映射 |
| Paid(orderId, amount) | 支付确认 |
| DisputeOpened(orderId) | 进入争议 |
| ResolutionExecuted(orderId, resultType) | 资金终态 |

**DB 状态仅由以上事件驱动。**

**五、Finality 与 reorg（P0）**

| 项目 | 规则 |
|------|------|
| finalityN | 12 blocks |
| event 表字段 | blockNumber / blockHash / txHash / logIndex |
| checkpoint | (blockNumber, logIndex) |
| reorg 处理 | 回退安全高度 → 重放事件 |
| 状态来源 | 仅链上事件 |

投影必须可重建。CI 必须跑 event replay 对比测试。

**六、合约技术栈（写死）**

| 模块 | 技术 |
|------|------|
| 合约语言 | Solidity |
| 代理模式 | EIP-1167 minimal proxy |
| 签名 | EIP-712 |
| 后端交互 | Rust + alloy |
| 审计前冻结 | P0 条款全部完成 |

**七、MVP 链级最终决策块（可直接入总库）**

```
Chain:
  name: Polygon PoS
  chainId: 137
  multiChain: false

Token:
  symbol: USDC
  standard: ERC20
  stableOnly: true

Escrow:
  factoryPattern: EIP-1167
  orderIdType: bytes32
  eventsAsSourceOfTruth: true

Finality:
  blocks: 12
  reorgHandled: true

PlatformToken:
  issued: false
```

**八、系统级不变量（链与资金相关 · 本节约束）**

- DB 永远不是资金真相。
- 资金终态只能由链上事件驱动。
- 一个订单只能有一个 EscrowInstance。
- 一个 EscrowInstance 只能进入一个资金终态。
- orderId 永不跨链。
- 不允许「人工直接改资金状态」。

*完整系统级不变量（含治理/执行器类）见文末「系统级不可违反不变量（最终版）」。

**九、代币 Allowlist 与治理（P0）**  
**1️⃣ 支持类型**：ERC-20 标准。**MVP 写死**：仅 USDC（与上「二、结算代币定稿」一致）；扩展时 allowlist 可增 USDT/DAI，治理见下。**每笔订单固定一个 token**；**订单创建后 token 不可修改**。**2️⃣ Allowlist 治理（必须写死）**：**addToken(address token)** / **removeToken(address token)** 均**多签治理+timelock≥48h**；发事件 **TokenAllowlistUpdated(token, true|false)**；**链上 allowlist 为唯一 source of truth，DB 仅缓存**。协议升级与治理币的完整安全模型（Proxy、Timelock、双层多签执行、三阶段演进）见 [08-战略与合规风险检查清单](08-1-战略与合规风险检查清单.md)「治理币与升级安全模型」。**3️⃣ 移除代币的强制语义（P0）**：

| 场景 | 行为 |
|------|------|
| 已 Escrowed | 正常执行至终态 |
| 已 Accepted 未支付 | 禁止支付 |
| 新订单 | 禁止选择 |
| 争议执行 | 按原 token 结算 |

**禁止行为**：强制换币；中途修改 token；**后端绕过 allowlist**。**ERC20（P0）**：仅标准 ERC20；上线前 token 验收 checklist 写死。deposit() 以实际到账计 PaidAmount。transferFrom/approve/黑名单失败→DB 保持 pending。

**十、Escrow 与金额（P0）**

单笔 escrow 单币；对账以链上事件为准。**金额与费用（P0）**：最小单位；DB 存整数；platformFee=amount×feeRate/10_000 向下取整；dust 归平台；**合约内计算**。**平台费收取时点**：

| 终态 | 是否收平台费 |
|------|--------------|
| Completed | 收 |
| PartiallyRefunded | 收（按实际给导游金额） |
| Slashed | 收（按实际给导游金额） |
| Refunded（全退） | **不收** |
| Cancelled | **不收** |

**禁止**：Escrow 阶段提前扣费；争议中预扣费。**价值守恒** fuzz 覆盖。**Paid**：仅 deposit()→Paid；直转不算。**topUp/重复 Paid（P0）**：二选一；存在则 DB 合并规则 deterministic。**误转/代币异常（P0）**：仅认 deposit()；直转不算；自证 runbook。transferFrom 失败→revert；DB pending；不人工置 Paid、不绕过 allowlist。**Fee**：Paid 时封存 feePolicyId+feeAmounts；费率变更只影响未 Paid。**分账（P0）**：链上可复算或 Paid 事件完整。**仲裁费（P0 锁死）**：openDispute() 必须付 arbFee，否则 revert；arbFee 进 Escrow 独立槽位、与订单 token 相同。**裁决后 arbFee**：

| 裁决结果 | arbFee 处理 |
|----------|-------------|
| 争议驳回（维持放款） | **不退** |
| 全额支持发起方 | 全退 |
| 部分支持 | 按比例退 |
| 恶意争议 | 可额外扣罚 **stake** |

**arbFee 不计入平台费**。**重复争议**：disputeCounter 永久递增；arbFee_n=baseFee×2^(n-1)，上限≤5×baseFee；counter 不因裁决清零。**争议窗口与自动完成（P0）**：autoCompleteAt=tripEndAt+K，disputeDeadline≥autoCompleteAt，否则部署参数非法。放款须满足：时间≥autoCompleteAt、未 Disputed、服务开始证据满足最小集合。**服务开始证据**：满足其一——双方 EIP-712 签到；导游签到+游客 W 时间内未异议；时间锚+证据哈希；否则允许 refundIfNotStarted()。**slash 归集**：StakingInsurancePool|PlatformTreasury|Burn 选一。**Token 异常**：A 不垫付 or B 保险池（来源/上限/审批写死），不得模糊。**取消/No-show**：各档写死（[03](03-业务流程与风控.md)）。**资金坏链路（P0-5）**：executeResolution 原子；transfer 失败→Disputed+retry；超 N 次→工单+告警；禁止线下转账改状态。争议窗口与 executeResolution 原子性见本段上文（openDispute→isFrozen；禁止部分成功）。

**十一、档期·双签·合约安全（P0）**

**档期（P0）**：Accepted 占档，Created 软占 TTL；capacity 写死。**时间**：block.timestamp/UTC；deadline 以实例为准。**双签与防护（P0）**：EIP-712 含 chainId/orderId/nonce/expiry/termsVersionHash/actionType；nonce 单调、domainSeparator 固定；双签仅确认完成、双签后金额不可改、不可再 dispute。**合约安全（P0）**：nonReentrant+effects-before-interactions；仅 ERC20 拒 ERC777。**工厂/版本**：pause 老 factory 不影响存量；ABI 只增字段不改语义；灰度与回滚写死。

---

## 6. 哪些用数据库

用户/导游/订单/证据/审计存 DB。**证据（P1）**：原件链下，链上 hash+schemaVersion；不可抵赖（P0）：schemaVersion+canonicalization 入 hash；时间戳可信策略写死。**访问（P0）**：pre-signed URL、工单内可读、每次读审计。**证据可用性（P0-3）**：重建工具须提供；存储不可用/证据已删除时 SLA 与公平性口径写死。**隐私（P0-4）**：PII 表、链上不存、DB 加密/KMS、访问审计与拒绝策略写死。**保留与删除（P0）**：保留期与谁批准写死。见 [04](04-后端与API.md)。

**分布式 DB**：可替换为 CockroachDB/TiDB/YugabyteDB；持久化用 trait 抽象，SQL 尽量标准。选型见 [04](04-后端与API.md)。

---

## 7. DApp 与 UI 统一

**Yew 前端（已锁定）**：普通 Web / DApp，表现层见 [05-前端总览](05-前端总览.md)、[02-架构设计](02-架构设计.md)。**钱包（P1）**：SIWE；deposit/confirm/openDispute 须钱包签。**EIP-712（P0）**：Domain Separator 写死；Paid 后换钱包=dispute 或新单。**UI 事实（P0）**：已支付仅来自链上 Paid/对账；pending 展示 confirmations。**代付（P0）**：默认不托管；后端不持私钥/不代签/不接受用户转后端；代付 PR 触发法务门禁。

---

### 权限与角色（P0，必须写死）

| 维度 | 约定 |
|------|------|
| **角色** | 游客/导游/仲裁员/运营/执行器/管理员/多签；[02](02-架构设计.md)/[04](04-后端与API.md) RBAC 定稿。 |
| **链上权限** | Registry/Staking/Escrow 仅对应权限账户；执行器=多签/时间锁，非单点热钱包。 |
| **冻结** | suspended 禁接单；withdrawFrozen 禁解押可 slash；触发=风控→运营→多签。 |
| **多签/时间锁** | pause/registry/staking/executeResolution 阈值+timelock 定稿。Break-glass：白名单+审计+事后报告写死。 |
| **Pause 后** | 游客 refundIfNotStarted/withdrawUnsettled；导游 withdrawStake；执行器 executeResolution（建议仅退款/撤销型）。**自救（P0）**：refund 类仅 Escrowed 且未到 tripStartAt/未满足服务证据时可用。 |
| **执行器（P0）** | 单笔/单日金额上限写死；超限拒绝+告警；批量双人审批。 |

支付/确认=用户/导游签；裁决后=**执行器**代发；每次落 orderId/evidenceHash/decisionHash/txHash+幂等+重试。**仲裁员（P0）**：类型写死；decision 含工单号；**签名须含 arbiterRoleSnapshotHash 或 arbiterAuthVersion**。

**角色与 RBAC 快照一致性（P0-2）**：以下 8 项须写成**选项→最终选定→理由→可验证约束→证据产物**，便于开工与审计：

| # | 项 | 选项 | 最终选定 | 理由 | 可验证约束 | 证据产物 |
|---|----|------|----------|------|------------|----------|
| 1 | 主身份 | 邮箱 / 钱包 / 绑定体 | （写死其一） | 防归属争议、一邮箱多钱包时谁签写死 | 下单/争议/证据提交时校验签名钱包与主身份一致 | 审计表：orderId + 主身份标识 + 签名 wallet |
| 2 | 工厂 onchain mapping | 有 / 无（仅事件） | **强烈建议有** | DB 全丢+reorg 恢复成本最低 | 工厂合约 `orderId→escrowAddress` 可查或 runbook 写死 | 合约 Slither/单测；或 `recovery_runbook.md` |
| 3 | autoComplete 与 disputeWindow | 不等式+默认值 | 写死不等式与默认；与 [03](03-业务流程与风控.md) 争议窗口口径一致（disputeDeadline≥autoCompleteAt 等） | 防导游逼自动完成、游客晚一步 dispute 即输 | 合约/配置校验；见 [03](03-业务流程与风控.md) | config hash；E2E 时间窗口用例 |
| 4 | 服务开始证据最小集合 | 写死字段列表 | 决定 refundIfNotStarted 边界 | 无证据则不可逼自动完成 | 证据包 schema 校验必含最小集合 | evidenceSchemaVersion + 校验脚本输出 |
| 5 | 仲裁费政策 | 驳回退不退 / 重复递增公式 | 写死（驳回不退；重复 arbFee_n=baseFee×2^(n-1)，上限≤5×baseFee；见 §5 十） | 防恶意 dispute 卡放款 | 合约/后端校验费用与次数 | fee_policy.json；审计表 resolutionSeq+费用 |
| 6 | token 异常承诺 | 不垫付 / 保险池 | 二选一写死 | 黑名单/冻结时责任边界 | runbook+合约 allowedTokens 移除后 safe-path | runbook_token_frozen.md；allowed_tokens_hash |
| 7 | executeResolution 分级白名单 | 仅退款/仅撤销/全功能；Pause 更严 | 写死每档可执行 resolutionType | Pause 时仅允许自救型 | 合约前置条件+执行器白名单校验 | 合约单测；执行器 config hash |
| 8 | DB 全丢重建最小产物 | 每单字段集合 | 写死：token、gross、fees、participants、deadline、version、终态 | 仅靠事件可重建可审计状态 | 重建脚本输出 schema 断言；CI 演练 | rebuild_output_schema.json；rebuild_test.log |

**RBAC 快照（P0-2）**：快照生成与验签写死；撤销后历史签名有效，靠版本号/时间锚区分伪造。**双人审批/工单锚/审批撤销**写死。**执行器（P0-3）**：resolutionType 分级、防错单（escrowAddress==orderId）、SLA 超时行为写死。**裁决对象（P0）**：resolutionId 含 chainId/orderId/resolutionSeq/decisionHash；链上幂等；amounts 满足封存；额度上限写死。

---

**钱包**：不自研；兼容 EIP-1193、WalletConnect 等市场钱包，不绑定某一款。

---

## 8. 总库总览（仓库骨架）

**说明**：以下为**目标/规划结构**；当前 workspace 与目录以 [README 实现状态](../README.md)、[08-0](08-0-系列审计-命名排序与合并瘦身.md) §十二 为准（如 chain-client 为可选未入仓、api 子目录随实现逐步补齐）。

```
Wbe3-TravelTrust/
│
├── Cargo.toml                          # workspace 根
├── README.md
├── .gitignore
│
├── crates/
│   ├── core/                           # 领域层（纯 Rust，无 DB/链依赖）
│   │   ├── Cargo.toml
│   │   └── src/
│   │       ├── lib.rs
│   │       ├── types.rs                # User, Guide, Order, Dispute...
│   │       ├── escrow.rs               # 订单状态机
│   │       ├── staking.rs
│   │       ├── reputation.rs
│   │       └── identity.rs             # 可选：KYC/角色
│   │
│   ├── api/                            # 应用层 + 基础设施入口（后端）
│   │   ├── Cargo.toml
│   │   └── src/
│   │       ├── main.rs
│   │       ├── routes/                 # 认证、导游、订单、争议、支付回调
│   │       ├── handlers/
│   │       ├── db/                     # 持久化层：PostgreSQL 或分布式 DB (SQLx / trait 抽象)
│   │       ├── chain/                  # 链客户端封装（调合约、读状态）
│   │       └── config.rs
│   │
│   ├── web/                            # UI 层（Rust → WASM，Web + DApp 一体）
│   │   ├── Cargo.toml
│   │   ├── Trunk.toml
│   │   ├── index.html
│   │   └── src/
│   │       ├── lib.rs
│   │       ├── app.rs                  # 根组件、路由
│   │       ├── pages/                  # 游客 / 导游 / 仲裁 页面
│   │       ├── components/
│   │       ├── api/                    # 调后端 API
│   │       └── dapp/                   # 钱包连接、签名、调链（DApp 模式）
│   │
│   └── chain-client/                  # 可选：与链交互的共用封装（EVM：alloy 等）
│       └── src/
│           ├── lib.rs
│           ├── escrow.rs               # 调 Escrow 合约
│           ├── staking.rs
│           └── reputation.rs          # 存证/读链上信誉
│
├── contracts/                          # 智能合约（已采用 EVM，语言固定为 Solidity）；设计承诺与实现状态见 contracts/README.md
│   ├── escrow/                         # EscrowFactory + 托管实例（Solidity）
│   ├── staking/                        # 质押合约（Solidity）
│   ├── registry/                       # 资格注册（方案 B：链上发资格，可撤销/过期）（Solidity）
│   └── reputation/                     # 信誉存证（可选，Solidity）
│   # 其它链（Ink!/CosmWasm 等）为未来扩展，不在当前范围
│
└── docs/
    ├── 00-文档索引.md                  # 文档索引（建议先看）
    ├── 01-总库总览.md                  # 本文（总库总览）
    ├── 02-架构设计.md                  # 架构设计（分层、子域、状态机）
    ├── 03-业务流程与风控.md            # 流程缺口、评分公平、争议人工裁决
    ├── 04-后端与API.md                 # 后端与 API（数据表、路由、风控）
    ├── 05-前端总览.md                  # 前端总览（Yew 结构、预约→上链→钱包付代币）
    ├── 06-DApp架构总览.md              # DApp 架构设计总览
    └── 07-开发流程与顺序.md            # 企业级开发流程与顺序
```

---

## 9. 数据流与职责一览

| 角色/端 | 主要操作 | 路径 |
|---------|----------|------|
| 游客 | 注册/登录、账号、浏览/下单/支付/评价、我的订单 | API(auth,/me)；支付→钱包签→合约 或 代付 |
| 导游 | 注册/登录、导游注册、质押、接单、确认、仪表盘 | API；质押/确认→钱包签→合约 |
| 仲裁员 | 登录、查看争议、裁决 | API→DB；裁决上链=执行器代发 |
| 后端 | 认证、业务、DB、读链、执行器代发裁决 tx | API↔DB↔RPC；签名前端发起、执行后端发起 |

**Web 与 DApp 业务数据同源（P0）**：旅行行程、接待人员（导游）信息、订单详情、档期、争议与证据等**业务数据唯一来源为后端 API/DB**；普通 Web 与 DApp/Web3 页面**共用同一 API**，不因是否连接钱包而分源。同一订单在 Web 页与 DApp 页展示的行程、接待人、订单状态须一致。链上仅作资金与托管状态；业务展示以 API 为准。见 [05-前端总览](05-前端总览.md)、[06-DApp架构总览](06-DApp架构总览.md)。

---

**对账（P0）**：三段式（自动修/半自动/人工）；触发条件与金额/次数上限写死。**SLO（P0-7）**：六项指标+阈值与动作写死。**链无 DB 有 Paid**：全局 pause 或仅冻结该单、防扩散写死。**Reorg/Finality（P0）**：见 §5 链与代币选型·五、Finality 与 reorg（finalityN=12、event 表、checkpoint、重放）；此处仅强调：副作用可重放、通知幂等。**Indexer 配置**：同一配置源、diagnostics bundle、每事件 finalityNUsed、变更后全量重放写死。

---

### 发布与 E2E（P2）

*以下为发布与运维相关 P0，与数据流、对账配合执行。*

**E2E**：正常放款、争议三终态、三条超时路径；见 [07](07-开发流程与顺序.md)。**合约地址/manifest/可观测（P0）**：订单写 escrowVersion/factoryAddress；manifest 含字节码/配置/checkpoint/E2E；traceId 贯通 requestId→messageId→txHash→logIndex（API 响应头 x-request-id 即 requestId；对账/执行器消费消息时 messageId 与 x-request-id 的关联方式见 [04](04-后端与API.md) §四）；审计导出包含 3 类样本全链路证据。**资损 runbook（P0）至少 5 条**：① RPC 大面积不可用；② Indexer 落后；③ reorg 触发撤销；④ 执行器卡单；⑤ token 冻结/黑名单导致结算失败。**orderId↔escrow 一对一**：EscrowCreated 后不可变更；改期/换币=新 orderId+新 escrow。**实例（P0）**：Paid 时封存 participants 等；guest/guide!=0；换钱包=dispute 或新单。**EscrowFactory**：escrowOf 不可覆盖；EscrowCreated 必发；DB 丢可链上重建。**Escrow 不变量**：资金守恒（含 arbFeeBalance）；终态唯一；release/refund/executeResolution 各一次；resolutionId=keccak256(chainId,orderId,resolutionSeq,decisionHash)；transfer 失败 revert、状态改在 transfer 后。**Paid 事件**含 grossAmount/token/feePolicyId/participants/deadline/version。**DB 全丢重建（P0-6）**：最小产物+脚本/CI 写死。

---

## 10. 小结

| 项目 | 结论 |
|------|------|
| 架构 | **混合**：链上 Escrow+Staking+Registry+信誉，DB 业务与检索；**EVM+Solidity**，链下 Rust。 |
| 合约 | **必须**：Escrow、Staking、Registry（方案 B）；**建议**：Reputation。 |
| 总库 | core / api / web / chain-client / contracts；用户与账号见 §2 用户与账号体系、[04](04-后端与API.md)/[05](05-前端总览.md)。 |
| 链 vs DB | **链为准**：Paid/Released/Refunded/Slashed、订单↔escrow；**DB 为准**：行程、证据、评价、用户资料。 |
| 裁决执行 | 后台执行器（多签/时间锁）代发；用户/导游支付与确认各自钱包签名。 |
| 订单终态 | Completed / Refunded / PartiallyRefunded / Slashed / Cancelled；Disputed 裁决后必落其一。 |
| 导游准入 | **方案 B**：质押在 Staking 合约；可接单 = 链上 `registry.approved && !suspended && now<expiry && staking>=minStake(tier)`。 |
| E2E 与发布 | 正常放款、争议三终态、三条超时路径必测；老订单不迁移、新单用新工厂。 |

**P0 条款索引（节内引用）**：身份与订单所有者 P0-1（§2）；RBAC 与 8 项写死 P0-2（§7 权限与角色）；证据可用性 P0-3、执行器分级 P0-3（§6、§7）；隐私 P0-4、资金坏链路 P0-5、DB 全丢重建 P0-6、SLO P0-7（§6、§9）；双签与防护（P0，见 §5 十一）。其余 P0 见各表「P0」标注。

**P0 必写死 12 缝**（实现与审计前必须定稿）：

| # | 缝 | 写死内容 |
|---|----|----------|
| 1 | topUp | 是否存在；存在则 DB 合并规则写死（首笔/最新/最大其一） |
| 2 | dispute 多次 | 是否允许；允许则费用递增公式写死 |
| 3 | 自动放款 vs DisputeWindow | 触发点与 DisputeWindow 截止的**严格不等式** |
| 4 | executeResolution 绑定 | 绑定实例地址或从 orderId 反查实例/工厂版本的方式 |
| 5 | resolutionSeq | 合约状态中存储与**单调递增** |
| 6 | Pause 白名单 | 每函数**前置条件**（自救但不破坏资金公平） |
| 7 | allowedTokens remove | 移除后存量结算 **safe-path 定义** |
| 8 | finalityN 修改 | 修改后的**重放/校验流程** |
| 9 | 事件消费 checkpoint | 含 **logIndex** 的 checkpoint 细节 |
| 10 | 证据时间戳 | 可信策略（TSA/区块时间锚定） |
| 11 | 钱包解绑/换绑 | 与已支付订单的**硬规则**（UI+文档） |
| 12 | 取消/No-show 矩阵 | **platformFee/arbitrationFee 退不退、退给谁** 口径 |

**12 缝→08-3/03 参数 key 对照表**（实现与审计一键核对用）：

| # | 缝 | 08-3 param_key 或 文档落点 |
|---|----|----------------------------|
| 1 | topUp | 无独立 key；DB 合并规则见 01/04 定稿、17 条 #3 |
| 2 | dispute 多次 | arbFeeBase、arbFeeMultiplier、arbFeeCap（08-3）；03 §3.2 |
| 3 | 自动放款 vs DisputeWindow | disputeWindowMin、autoCompleteDelay（08-3）；03 §1.3；不等式 disputeDeadline≥autoCompleteAt |
| 4 | executeResolution 绑定 | 合约/02 §七；无 08-3 key |
| 5 | resolutionSeq | 合约状态；无 08-3 key |
| 6 | Pause 白名单 | pauseCooldown、pauseAllowlist（08-3）；Runbook §1 |
| 7 | allowedTokens remove | 合约 allowlist；08-4/Runbook 安全路径 |
| 8 | finalityN 修改 | finalityN（08-3）；Runbook §11 重放流程 |
| 9 | 事件消费 checkpoint | 01 §5、02 §十二；event 表 blockNumber+logIndex |
| 10 | 证据时间戳 | serviceStartTimeSource（08-3）；01 §6、03 §3.3/3.5 |
| 11 | 钱包解绑/换绑 | 01 §2、04 §二 2.1、05/06 UI+文档；无 08-3 key |
| 12 | 取消/No-show 矩阵 | 03 §1.2；platformFee/arbitrationFee 口径见 01 §10、08-4 第 3 章 |

### 审计验收表（17 条）

每条：**Invariant/Rule**（一句话硬约束）→ **How to verify**（如何验证）→ **Evidence artifact**（证据产物）→ **Failure action**（失败时系统行为）。

| # | Invariant / Rule | How to verify | Evidence artifact | Failure action |
|---|------------------|---------------|-------------------|----------------|
| 1 | **价值守恒**：所有终态 payout+refund+slash+platformFee(+arbitrationFee)==grossAmount | Foundry invariant / Echidna 属性测试；每终态路径单测 | `invariant_test_results.json`；manifest 中 `contract_bytecode_sha256` | 合约 revert；属性测试失败则阻塞发布 |
| 2 | **Paid 仅来自 deposit()**：仅 deposit(orderId,amount)→transferFrom→Paid 事件算已支付；直转/误转不算 | 合约单测：直转不触发 Paid；E2E：支付流程仅经 deposit | 链上事件日志；E2E 截图 `e2e_payment_via_deposit.png` | 误转：DB 保持 pending；客服工单+链上自助证明 runbook |
| 3 | **topUp/重复 Paid 规则**：是否存在二选一；若存在则 DB 合并规则写死且 deterministic（首笔/最新/最大其一） | 单测：多 Paid 事件重放→投影一致；CI 重建对比测试 | `projection_rebuild_test.log`；config 中 `paid_merge_rule` | 禁止二次 deposit 或仅 topUp；DB 只认最终有效 Paid |
| 4 | **orderId↔escrow 一对一**：EscrowCreated 后不可变更；改期/换导游/换币=新 orderId+新 escrow | E2E：改期流创建新单；对账脚本校验 orderId→escrow 唯一 | 对账脚本输出 `reconciliation_order_escrow.csv` | 旧单走取消/争议终态；新单才绑定新 escrow |
| 5 | **participants 不可变**：guest/guide != address(0)；Paid 后实例内不可改 | 合约单测：participants 写入后无 setter；fuzz 无零地址 | 合约 Slither 报告；部署参数记录 | 部署/升级前校验；错误则 revert |
| 6 | **Paid 事件可重建结算**：事件含 grossAmount、token、feePolicyId、participants、deadline/version；DB 全丢可仅靠事件重建 | 事件 schema 断言；脚本：仅消费事件→生成结算表与 DB 投影对比 | `event_schema_assertion.json`；`rebuild_from_events_test.log` | Indexer 拒绝缺字段事件；对账告警 |
| 7 | **PartiallyRefunded/Slashed 合法组合集**：amounts 支持平台费/仲裁费不退+导游/游客分+slash 进池；合法组合写死，执行器不可随意拼 | 合约校验 amounts 在合法组合内；单测枚举合法/非法组合 | `resolution_amount_rules.json`；执行器单测 | 非法组合 revert；执行器超限告警+工单 |
| 8 | **token 异常后承诺**：黑名单/冻结/暂停导致无法 transfer 时，平台承诺写死（链上证明+工单 或 替代结算/垫付及风险） | 文档与 runbook 评审；token 冻结 E2E 或演练 | `runbook_token_frozen.md`；manifest 中 `allowed_tokens_hash` | 按承诺路径：工单+链上证明 或 触发垫付流程+审计 |
| 9 | **Dispute 与自动放款互斥**：争议窗口截止不早于自动放款（disputeDeadline≥autoCompleteAt），否则部署参数非法；openDispute 设 isFrozen，自动放款检查 isFrozen | 合约单测：isFrozen 时 release revert；E2E：dispute 后不自动放款 | 链上事件 DisputeOpened；config 校验 disputeDeadline≥autoCompleteAt | 链上为准；预冻结仅 UX，不驱动终态 |
| 10 | **executeResolution 绑定实例+守恒**：传入 escrowAddress 且校验==orderId 的 escrow；amounts 满足封存 grossAmount/feePolicy；resolutionSeq 单调递增 | 合约单测：错 escrow revert；错误 amounts revert；resolutionSeq 递增断言 | 执行器审计表 `resolution_approval_*.json`；合约测试 | 错单 revert；超限拒绝+告警+工单+UI“等待人工复核” |
| 11 | **裁决签名含 RBAC 快照**：decision 签名含 arbiterRoleSnapshotHash 或 arbiterAuthVersion；双人审批：发起人/复核人/时间/输入/审批结果 hash 落审计 | 签名解析单测；审计表 schema 校验；导出 evidence pack SHA256 | `evidence_pack_manifest_sha256`；审计表 append-only | 缺快照则拒绝上链；审批未达标则拒绝执行 |
| 12 | **DB 状态仅链事件驱动**：Paid/Completed/Refunded/PartiallyRefunded/Slashed 仅由达 finalityN 的事件驱动；人工修复只写 correction，主状态由重放生成 | 对账脚本：主状态与事件投影一致；禁止直改主状态 CI 检查 | `correction_log` 表；对账报告 `reconciliation_report_*.json` | 差异告警；自动修/半自动/人工三段式；超修上限停自动修 |
| 13 | **reorg 撤销与投影回退**：同 txHash 不同 blockHash→撤销旧事件并重算投影；回退时副作用补偿写死（通知更正、撤销档期） | reorg 测试：重放后投影与 event 表一致；副作用补偿单测 | `reorg_handling_test.log`；checkpoint `(blockNumber,logIndex)` | 撤销旧事件；重算投影；触发补偿（通知/档期）不重复发 |
| 14 | **幂等键覆盖四类来源**：API 重试→requestId/idempotency-key；队列→消费幂等键；执行器→resolutionId；用户连点→orderId+action | 各层单测：重复请求/重复投递/重复执行/重复签名均幂等 | API 日志 `idempotency_key`；队列消费日志；执行器 `executed[resolutionId]` | 重复请求返回原结果；重复执行 revert；连点只认一笔 |
| 15 | **对账三段式触发条件**：何种差异进哪段写死（如链有 DB 无→自动补；链无 DB 有 Paid→告警+冻结进工单）；自动修有最大金额/次数上限 | 对账脚本与规则表；单测：差异类型→处置段 | `reconciliation_rules.json`；对账运行日志 | 自动修达上限→转半自动/人工；链无 DB 有→冻结订单+工单 |
| 16 | **状态机与副作用联动**：每状态迁移触发的占档/解档/通知/评价/冻结写死；回放不导致副作用重复/错发 | 状态机单测：迁移→副作用列表；回放测试无重复通知/占档 | `state_machine_side_effects.json`；通知/档期审计日志 | 副作用幂等或补偿；回退时发更正通知/撤销档期 |
| 17 | **finalityN 与配置单一来源**：finalityN、replayFromBlock、rpcAllowlist、chainIdAllowlist 同一配置源；每条事件写 finalityNUsed；finalityN 修改后全量重放/校验 | 配置校验脚本；event 表 finalityNUsed 非空；重放流程 runbook | `diagnostics_bundle_hash`；`config.toml`+env 的 hash；`replay_after_finality_change.log` | 配置漂移告警；修改 finalityN 后必须跑重放流程，否则旧数据口径混杂 |

### 审计前检查清单（企业级）

| 检查项 | 要求 |
|--------|------|
| **12 缝** | 每条缝均有默认值或写死结论，无「待定」 |
| **17 条验收** | 每条对应单测/E2E/对账脚本或 runbook，可产出 Evidence artifact |
| **资损 runbook** | 至少 5 条（RPC/Indexer/reorg/执行器卡单/token 冻结）已落文档 |
| **系统级不变量** | 与合约与后端设计逐条对齐，无冲突 |

**12 缝与 17 条对应**：缝 1–3→验收 3/9；缝 4–6→验收 10/6/9；缝 7–8→验收 8/17；缝 9–12→验收 13/11/4/15 等；实现时须双向可追溯。

**12 缝→17 条验收编号对照表**（单测/E2E/runbook 覆盖检查用）：

| 缝 # | 对应 17 条验收编号 |
|------|---------------------|
| 1 topUp | #3 |
| 2 dispute 多次 | #3、#10（费用） |
| 3 自动放款 vs DisputeWindow | #9 |
| 4 executeResolution 绑定 | #10 |
| 5 resolutionSeq | #10 |
| 6 Pause 白名单 | #8、#9 |
| 7 allowedTokens remove | #8 |
| 8 finalityN 修改 | #17 |
| 9 事件消费 checkpoint | #13 |
| 10 证据时间戳 | 01 §6、03 §3.3/3.5；08-3 serviceStartTimeSource |
| 11 钱包解绑/换绑 | #4、#14（幂等） |
| 12 取消/No-show 矩阵 | #15、#16 |

### 系统级不可违反不变量（最终版）

**资金类**：Escrow 余额守恒；平台费仅终态扣除；每订单只能有一个资金终态；**arbFee 不计入平台收入**。**映射类**：orderId↔escrow 唯一；orderId 绑定 chainId；token 不可修改。**状态类**：Disputed 必须进入资金终态；非终态不可评价；Registry 撤销不影响已 Escrowed。**事件驱动类**：Paid/Released/Refunded/Slashed **仅由链上 final 事件驱动**；**DB 主状态可完全由 event 重建**。**治理类**：allowlist 变更多签+**timelock≥48h**；feePolicy 变更不影响已 Paid；**VC issuer allowlist 变更多签+timelock**。**执行器类**：resolutionId 唯一；executeResolution 原子执行；**disputeCounter 永久递增**。

---

**P0/P1/P2** 见上文各表。以上为 TravelTrust 总库总览；细节见 [02](02-架构设计.md)、[03](03-业务流程与风控.md)、[04](04-后端与API.md)、[05](05-前端总览.md)、[06](06-DApp架构总览.md)、[07](07-开发流程与顺序.md)、[08](08-1-战略与合规风险检查清单.md)。

*本文与 [02-架构设计](02-架构设计.md)、[03-业务流程与风控](03-业务流程与风控.md)、[04-后端与API](04-后端与API.md)、[05-前端总览](05-前端总览.md)、[06-DApp架构总览](06-DApp架构总览.md)、[07-开发流程与顺序](07-开发流程与顺序.md)、[08-战略与合规风险检查清单](08-1-战略与合规风险检查清单.md) 配套。文档版本与最后更新见 [00-文档索引](00-文档索引.md)。*
